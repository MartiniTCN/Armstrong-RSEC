<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth dark">
  <!-- ✅ html2pdf.js CDN：用于将页面导出为 PDF -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EE-W 产品培训测试系统</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

	<!-- ✅ 🆕 立即加上这段，开启 dark 模式支持 -->
  <script>
    tailwind.config = {
      darkMode: 'class'
    };
  </script>



<style>
  /* ✅ 避免分页时拆行 */
  tr {
    page-break-inside: avoid !important;
    break-inside: avoid !important;
  }

  /* ✅ 完整内容居中，防止边缘溢出 */
  #completePage {
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
  }

  /* ✅ 小屏适配：答题页和表格字体适配 */
  @media screen and (max-width: 768px) {
    #completePage {
      font-size: 13px;
    }

    table {
      font-size: 12px;
    }

    td, th {
      padding: 6px 4px;
      word-break: break-word;
    }
  }

  /* ✅ 居中显示倒计时提示 + 按钮 */
#countdownCenterOverlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255,255,255,0.75);
  backdrop-filter: blur(6px);
  z-index: 9999;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  color: #1f2937; /* text-gray-800 */
  font-size: 18px;
}

#countdownCenterOverlay button {
  margin-top: 1rem;
  padding: 0.5rem 1.5rem;
  border-radius: 9999px;
  background: #16a34a; /* bg-green-600 */
  color: white;
  font-weight: bold;
  border: none;
  cursor: pointer;
}

</style>

<!-- ✅ 正确引入 EmailJS 的浏览器版本 SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script>
  // ✅ 初始化 EmailJS，必须放在引入之后
  (function() {
    emailjs.init("LoQCI3C98dk3FgEvj");
  })();
</script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <style>
	
        /* 保持原有所有样式 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        .animate-spin { animation: spin 1s linear infinite; }
        .option-selected { background-color: rgba(59, 130, 246, 0.1); }
        .page { display: none; }
        .active-page { display: block; }
        .input-field-highlight {
            @apply w-full p-2 rounded-md border-2 border-blue-300 shadow-sm 
                   dark:border-blue-500 transition-colors focus:ring-2 
                   focus:ring-blue-500 focus:border-blue-500;
        }
        .question-card {
            @apply p-6 rounded-lg bg-gray-50 dark:bg-gray-700 
                   transition-colors hover:bg-gray-100 dark:hover:bg-gray-600
                   mb-6 border-2 border-transparent;
        }
        .options-grid {
            @apply grid grid-cols-1 md:grid-cols-2 gap-4;
        }
        .option {
            @apply flex items-center p-3 rounded-lg border-2 border-gray-200
                   dark:border-gray-600 cursor-pointer transition-all
                   hover:border-blue-500;
        }
        .option input {
            @apply mr-3;
        }
		.option span {
  color: #1f2937; /* light mode 默认颜色 */
}

.dark .option span {
  color: #e5e7eb; /* dark mode 字体颜色 */
}
        .judge-card {
            @apply p-4 rounded-lg bg-gray-50 dark:bg-gray-700
                   border-2 border-transparent;
        }
        .judge-btn {
            @apply w-12 h-12 flex items-center justify-center rounded-full 
                   border-2 border-gray-300 dark:border-gray-600 
                   hover:border-blue-500 cursor-pointer transition-all;
        }
        .judge-btn i {
            @apply text-xl opacity-0 transition-opacity;
        }
        .judge-btn input:checked ~ i {
            @apply opacity-100;
        }
        .border-red-500 {
            border-color: rgb(239 68 68) !important;
        }
		
 /* ✅ 加入弹出提示动画 */
    .fade-in-bounce {
      animation: fadeInBounce 0.5s ease-out;
    }
    @keyframes fadeInBounce {
      0% { opacity: 0; transform: translateY(-20px); }
      60% { transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }
		
/* ✅ 用于动态生成的打乱水印元素样式 */
.watermark-random {
  position: fixed;
  width: 220px;
  height: 220px;
  background-image: url('https://i.stardots.io/armstrong/水印图片 - 金色_副本.png?width=500&rotate=0&blur=0&quality=50');
  background-repeat: no-repeat;
  background-size: contain;
  background-position: center;
  opacity: 0.2;
  z-index: 0;
  pointer-events: none;
}

/* ✅ 页面模糊时使用的样式 */
.blur-overlay {
  filter: blur(5px);
  pointer-events: none;
  user-select: none;
  transition: all 0.3s ease;
}

/* ✅ 倒计时和暂停按钮容器样式 */
#examStatusBar {
  position: fixed;
  top: 18px; /* 稍微离顶部远一点 */
  left: 50%;
  transform: translateX(-50%);
  background-color: #dc2626; /* 红色背景 */
  color: white;
  padding: 0.3rem 1rem; /* ✅ 上下更窄，左右保留 */
  border-radius: 9999px; /* 胶囊形状 */
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1rem;
  font-size: 0.875rem; /* 稍小字体 */
  font-weight: 600;
  z-index: 9999;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  height: auto;
  line-height: 1;
}

#examStatusBar button {
  background-color: white;
  color: #dc2626;
  font-weight: 600;
  padding: 0.2rem 0.75rem; /* ✅ 更小按钮尺寸 */
  border-radius: 9999px;
  font-size: 0.75rem;
  line-height: 1;
  transition: all 0.2s ease;
}

#examStatusBar button:hover {
  background-color: #fef2f2;
}

@media (max-width: 640px) {
  #examStatusBar {
    top: auto !important;
    bottom: 1rem;
    left: 50%;
    transform: translateX(-50%);
    padding: 0.2rem 0.6rem;
    font-size: 0.75rem;
    gap: 0.5rem;
  }

  #examStatusBar button {
    padding: 0.15rem 0.5rem;
    font-size: 0.6rem;
  }

  #examStatusBar button i {
    margin-right: 0 !important;
    font-size: 0.75rem;
  }

  #examStatusBar button span {
    display: none;
  }
}
    </style>

</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <!-- 加载遮罩 -->
    <div id="loading" class="fixed inset-0 bg-black/50 z-50 hidden">
        <div class="flex items-center justify-center h-full">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg flex items-center">
                <i class="fas fa-spinner animate-spin text-2xl text-blue-500 mr-3"></i>
                <span class="text-gray-700 dark:text-gray-200">正在生成报告...</span>
            </div>
        </div>
    </div>

    <!-- 导航栏 -->
    <nav class="sticky top-0 bg-white/80 dark:bg-gray-800/80 backdrop-blur border-b border-gray-200 dark:border-gray-700 z-40">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <img src="https://i.stardots.io/armstrong/Armstrong Logo - Martin.png?width=500&rotate=0&blur=0&quality=50" 
                     alt="Logo" class="h-8">
                <h1 class="text-xl font-bold text-gray-800 dark:text-gray-200">｜ EE-W产品培训测试系统</h1>
            </div>
		

            <div class="flex items-center gap-4">
                <button id="themeToggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                    <i class="fas fa-sun text-gray-600 dark:text-gray-300"></i>
                </button>
            </div>
        </div>
    </nav>
    	<!-- ✅ 将 examStatusBar 放在这里 -->
      <div id="examStatusBar" class="flex items-center gap-4 bg-red-600 text-white px-5 py-2 rounded-lg shadow-lg font-semibold">
        <span class="flex items-center">
          <i class="fas fa-clock mr-2"></i><span id="countdown">60:00</span>
        </span>
        <button onclick="togglePause()" id="pauseBtn" class="bg-white text-red-600 px-3 py-1 rounded-md hover:bg-red-100 transition-all">
          <i class="fas fa-pause mr-1"></i><span>暂停</span>
  </button>
</div>
    <!-- 删除首页 -->
    <section id="homePage" class="page container mx-auto px-4 py-8">
        <div class="bg-white dark:bg-gray-800 rounded-xl p-8 shadow-sm text-center max-w-3xl mx-auto">
            <h2 class="text-3xl font-bold mb-6 text-blue-600 dark:text-blue-400">EE-W 产品培训测试</h2>
            <div class="space-y-6 text-left text-gray-700 dark:text-gray-300">
                <p class="text-lg leading-relaxed">本次培训旨在帮助学员全面掌握EE-W系列解决方案的组成和应用，通过理论学习和实践操作相结合的方式，提升在水冷机房系统优化控制方面的专业技能。</p>
                
                <div class="p-4 bg-blue-50 dark:bg-gray-700 rounded-lg">
                    <h3 class="text-xl font-semibold mb-3 text-blue-800 dark:text-blue-200">培训大纲</h3>
                    <ul class="list-disc pl-6 space-y-2">
                        <li>EE-W系列控制系统的组成</li>
                        <li>水冷系统控制原理与优化策略</li>
                        <li>高效机房各组件的控制策略</li>
                        <li>市场竞争策略介绍</li>
                        <li>项目BOD 介绍</li>
                    </ul>
                </div>

                <div class="mt-6 p-4 bg-green-50 dark:bg-gray-700 rounded-lg">
                    <h3 class="text-xl font-semibold mb-3 text-green-800 dark:text-green-200">考核说明</h3>
                    <ul class="list-decimal pl-6 space-y-2">
                        <li>考试时间：60分钟</li>
                        <li>总分100分，80分合格</li>
                        <li>允许查阅培训资料</li>
                        <li>简答题需详细描述方案</li>
						<li>导出试卷后，发送到 chinarsec@armstrongfluidtechnology.com </li>
                    </ul>
                </div>

  <div class="flex justify-center mt-6">
  <button onclick="showTestPage()" 
    class="relative inline-flex items-center justify-center px-4 py-1.5 bg-gradient-to-r from-blue-500 to-indigo-600
           text-white text-sm font-medium rounded-full shadow-md hover:from-indigo-500 hover:to-blue-600
           transform hover:scale-105 transition-all duration-300 ease-in-out group overflow-hidden">
    <span class="relative z-10 flex items-center">
      <i class="fas fa-pen-to-square mr-2 text-white text-base"></i>
      开始考试
    </span>
    <!-- 💫 光晕动画 -->
    <div class="absolute inset-0 bg-white opacity-10 blur-xl group-hover:opacity-20 transition-all duration-500"></div>
  </button>
</div>
            </div>
        </div>
    </section>

    <!-- 直接进入测试页 -->
    <section id="testPage" class="page active-page container mx-auto px-4 py-6">
	

        <div class="flex justify-between mb-6">
          <a href="/course_selection.html" class="text-blue-600 dark:text-blue-400 hover:underline">
            <i class="fas fa-arrow-left mr-2"></i>返回课程选择页
        </a>
			<!-- ✅ 错误提示框：嵌入顶部 -->
    <div id="errorMessage"
         class="hidden mb-6 px-6 py-4 rounded-lg text-lg font-semibold text-red-700 bg-red-100 border border-red-400 shadow fade-in-bounce flex items-center gap-3">
      <i class="fas fa-exclamation-triangle"></i>
      <span id="errorText">请完善信息</span>
    </div>
            <div class="text-gray-600 dark:text-gray-300">
                <i class="fas fa-clock mr-2"></i>考试时间：60:00
            </div>
        </div>

        <!-- 学员信息表单 -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm mb-8">
            <h2 class="text-xl font-semibold mb-6 text-gray-800 dark:text-gray-200">
                <i class="fas fa-id-card mr-2 text-blue-500"></i>学员信息
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-bold mb-2 text-gray-700 dark:text-gray-300">
                        <span class="text-red-500">*</span> 公司名称
                    </label>
                    <input type="text" id="company" 
                        class="input-field-highlight bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600 rounded px-3 py-2 w-full" 
                        placeholder="请输入公司全称" required>
                </div>
                <div>
                    <label class="block text-sm font-bold mb-2 text-gray-700 dark:text-gray-300">
                        <span class="text-red-500">*</span> 学员姓名
                    </label>
                    <input type="text" id="name" 
                        class="bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600 rounded px-3 py-2 w-full"
                        placeholder="请输入真实姓名" required>
                </div>
                <div>
                    <label class="block text-sm font-bold mb-2 text-gray-700 dark:text-gray-300">
                        <span class="text-red-500">*</span> 手机号码
                    </label>
                    <input type="tel" id="phone" 
                        class="input-field-highlight bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600 rounded px-3 py-2 w-full"
                        placeholder="11位手机号码" pattern="[0-9]{11}" required>
                </div>
                <div>
                    <label class="block text-sm font-bold mb-2 text-gray-700 dark:text-gray-300">
                        <span class="text-red-500">*</span> 邮箱地址
                    </label>
                    <input type="email" id="email"
                        class="input-field-highlight bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600 rounded px-3 py-2 w-full"
                        placeholder="name@company.com" 
                        pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$" 
                        required>
                </div>
            </div>
        </div>

        <!-- 单选题 -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm mb-8">
            <h2 class="text-xl font-semibold mb-6 text-gray-800 dark:text-gray-200">
                <i class="fas fa-list-ol mr-2 text-blue-500"></i>单选题（每题2分，共40分）
            </h2>
            <div class="space-y-6">
                <!-- 题目1 -->
                <div class="question-card">
                    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">
                        1. EE-W控制器的主要控制对象是？
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                        <label class="option">
                            <input type="radio" name="q1" value="A" required>
                            <span>A. 风冷机组</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q1" value="B">
                            <span>B. 水冷一次泵系统</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q1" value="C">
                            <span>C. 冷却塔组</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q1" value="D">
                            <span>D. 末端风机盘管</span>
                        </label>
                    </div>
                </div>

                <!-- 题目2 -->
                <div class="question-card">
                    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">
                        2. EE-W10最多可控制多少台水泵？
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                        <label class="option">
                            <input type="radio" name="q2" value="A">
                            <span>A. 3台</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q2" value="B">
                            <span>B. 5台</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q2" value="C">
                            <span>C. 6台</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q2" value="D">
                            <span>D. 8台</span>
                        </label>
                    </div>
                </div>

                <!-- 题目3 -->
                <div class="question-card">
                    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">
                        3. 冷冻机启停控制的主要依据是？
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                        <label class="option">
                            <input type="radio" name="q3" value="A">
                            <span>A. 机房负荷需求</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3" value="B">
                            <span>B. 设定温度值</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3" value="C">
                            <span>C. 电流参数</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3" value="D">
                            <span>D. 冷却水流量</span>
                        </label>
                    </div>
                </div>
				
				<!-- 题目4 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">4. EE-W 系列产品的主要用途是什么？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q4" value="A"> <span>A. 控制风冷式冷冻机房</span></label>
      <label class="option"><input type="radio" name="q4" value="B"> <span>B. 实现水冷式一次变流量冷冻机房的自动控制</span></label>
      <label class="option"><input type="radio" name="q4" value="C"> <span>C. 仅控制水泵运行</span></label>
      <label class="option"><input type="radio" name="q4" value="D"> <span>D. 调节冷却塔的水温</span></label>
    </div>
  </div>

  <!-- 题目5 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">5. EE-W 系列控制器的控制范围中，等大水泵最多可控制多少台（含备用泵）？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q5" value="A"> <span>A. 3 台</span></label>
      <label class="option"><input type="radio" name="q5" value="B"> <span>B. 4 台</span></label>
      <label class="option"><input type="radio" name="q5" value="C"> <span>C. 5 台</span></label>
      <label class="option"><input type="radio" name="q5" value="D"> <span>D. 6 台</span></label>
    </div>
  </div>

  <!-- 题目6 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">6. EE-W 系列产品在控制冷冻机时，不能根据以下哪种信息计算工作冷冻机的最佳台数？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q6" value="A"> <span>A. 机房负荷</span></label>
      <label class="option"><input type="radio" name="q6" value="B"> <span>B. 冷冻水温度设定值的差异</span></label>
      <label class="option"><input type="radio" name="q6" value="C"> <span>C. 冷却塔的高度</span></label>
      <label class="option"><input type="radio" name="q6" value="D"> <span>D. 冷冻机电气负荷</span></label>
    </div>
  </div>
				<!-- 题目7 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">7. EE-W 系列产品中，与隔离阀接口相关的操作不包括以下哪项？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q7" value="A"> <span>A. 利用数字输出打开和关闭阀门</span></label>
      <label class="option"><input type="radio" name="q7" value="B"> <span>B. 利用数字输入获得阀门启/闭状态反馈</span></label>
      <label class="option"><input type="radio" name="q7" value="C"> <span>C. 自动调节隔离阀的流量大小</span></label>
      <label class="option"><input type="radio" name="q7" value="D"> <span>D. 根据控制逻辑控制隔离阀的动作</span></label>
    </div>
  </div>

  <!-- 题目8 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">8. EE-W 控制器在变流量一次泵控制中，若选用 Armstrong DE 泵，泵的启/闭控制依据是什么？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q8" value="A"> <span>A. 随机启动</span></label>
      <label class="option"><input type="radio" name="q8" value="B"> <span>B. 根据各泵的最佳效率点计算出最高效的工作泵组合</span></label>
      <label class="option"><input type="radio" name="q8" value="C"> <span>C. 按照时间顺序依次启动</span></label>
      <label class="option"><input type="radio" name="q8" value="D"> <span>D. 一台工作冷冻机配一台泵的固定模式</span></label>
    </div>
  </div>

  <!-- 题目9 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">9. EE-W 控制器在调节旁通阀时的主要目的是什么？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q9" value="A"> <span>A. 维持最高流量水平</span></label>
      <label class="option"><input type="radio" name="q9" value="B"> <span>B. 维持最低流量水平</span></label>
      <label class="option"><input type="radio" name="q9" value="C"> <span>C. 调节流量使其保持恒定</span></label>
      <label class="option"><input type="radio" name="q9" value="D"> <span>D. 根据温度变化调节流量</span></label>
    </div>
  </div>
  
  <!-- 题目10 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">10. EE-W 系列产品的主要控制逻辑中，不包括以下哪项？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q10" value="A"> <span>A. 基于需求大小控制冷冻机台数</span></label>
      <label class="option"><input type="radio" name="q10" value="B"> <span>B. 仅根据时间控制水泵转速</span></label>
      <label class="option"><input type="radio" name="q10" value="C"> <span>C. 对区域信号实施持续监控</span></label>
      <label class="option"><input type="radio" name="q10" value="D"> <span>D. 调节旁通阀维持流量</span></label>
    </div>
  </div>
  <!-- 题目11 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">11. EE-W 系列产品在控制冷冻机顺序时，以下哪个不是考虑因素？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q11" value="A"> <span>A. 机房负荷</span></label>
      <label class="option"><input type="radio" name="q11" value="B"> <span>B. 冷冻机高流量状态</span></label>
      <label class="option"><input type="radio" name="q11" value="C"> <span>C. 户外温度传感器数据</span></label>
      <label class="option"><input type="radio" name="q11" value="D"> <span>D. 冷冻机的颜色</span></label>
    </div>
  </div>

  <!-- 题目12 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">12. EE-W 系列产品在控制变流量一次泵的泵速时，在配有区域传感器的条件下，依据什么信号决定泵的工作转速？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q12" value="A"> <span>A. 仅区域温度传感器信号</span></label>
      <label class="option"><input type="radio" name="q12" value="B"> <span>B. 仅区域差压传感器信号</span></label>
      <label class="option"><input type="radio" name="q12" value="C"> <span>C. 区域差压传感器或区域温度传感器的信号</span></label>
      <label class="option"><input type="radio" name="q12" value="D"> <span>D. 机房总压力传感器信号</span></label>
    </div>
  </div>

  <!-- 题目13 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">13. EE-W 系列产品适用于以下哪种系统？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q13" value="A"> <span>A. 仅舒适制冷系统</span></label>
      <label class="option"><input type="radio" name="q13" value="B"> <span>B. 仅工艺制冷系统</span></label>
      <label class="option"><input type="radio" name="q13" value="C"> <span>C. 舒适或者工艺制冷系统</span></label>
      <label class="option"><input type="radio" name="q13" value="D"> <span>D. 制热系统</span></label>
    </div>
  </div>
  <!-- 题目14 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">14. EE-W 系列产品在控制冷冻机房设备时，对于大小主机的运行规则是怎样的？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q14" value="A"> <span>A. 可以同时随意开启</span></label>
      <label class="option"><input type="radio" name="q14" value="B"> <span>B. 大小主机不能同时开（GROUP1&GROUP2）</span></label>
      <label class="option"><input type="radio" name="q14" value="C"> <span>C. 小主机优先开启</span></label>
      <label class="option"><input type="radio" name="q14" value="D"> <span>D. 大主机优先开启</span></label>
    </div>
  </div>

  <!-- 题目15 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">15. EE-W 系列产品在控制冷却水泵时，相同的冷却水泵如何分组？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q15" value="A"> <span>A. 按照功率大小分组</span></label>
      <label class="option"><input type="radio" name="q15" value="B"> <span>B. 按照颜色分组</span></label>
      <label class="option"><input type="radio" name="q15" value="C"> <span>C. 与它们对应的冷机组关联，最多2组</span></label>
      <label class="option"><input type="radio" name="q15" value="D"> <span>D. 随机分组</span></label>
    </div>
  </div>

  <!-- 题目16 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">16. EE-W 系列产品在应用中，如果设备数量超过5台，应该采用什么方式？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q16" value="A"> <span>A. 无法控制</span></label>
      <label class="option"><input type="radio" name="q16" value="B"> <span>B. 增加控制器数量</span></label>
      <label class="option"><input type="radio" name="q16" value="C"> <span>C. 采用非标 NCP</span></label>
      <label class="option"><input type="radio" name="q16" value="D"> <span>D. 减少设备数量</span></label>
    </div>
  </div>

  <!-- 题目17 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">17. EE-W 控制器在控制冷冻机流量时，通过什么方式将其维持在设定范围内？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q17" value="A"> <span>A. 仅调节泵的启停</span></label>
      <label class="option"><input type="radio" name="q17" value="B"> <span>B. 仅调节泵速</span></label>
      <label class="option"><input type="radio" name="q17" value="C"> <span>C. 调节泵的启停和泵速</span></label>
      <label class="option"><input type="radio" name="q17" value="D"> <span>D. 手动调节流量阀门</span></label>
    </div>
  </div>

  <!-- 题目18 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">18. EE-W 系列产品在一次泵变流量系统中，若不选用 Armstrong DE 泵，泵的启/闭模式是怎样的？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q18" value="A"> <span>A. 依据各泵的最佳效率点计算</span></label>
      <label class="option"><input type="radio" name="q18" value="B"> <span>B. 一台工作冷冻机配一台泵</span></label>
      <label class="option"><input type="radio" name="q18" value="C"> <span>C. 全部泵同时启动</span></label>
      <label class="option"><input type="radio" name="q18" value="D"> <span>D. 随机启动</span></label>
    </div>
  </div>

  <!-- 题目19 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">19. EE-W 系列产品在控制不同品牌的冷冻机时如何实现通信控制？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q19" value="A"> <span>A. 无法通信</span></label>
      <label class="option"><input type="radio" name="q19" value="B"> <span>B. 通过预先列出的 Modbus/BACnet/Lonworks 协议映射实现通信</span></label>
      <label class="option"><input type="radio" name="q19" value="C"> <span>C. 只能使用特定品牌的协议</span></label>
      <label class="option"><input type="radio" name="q19" value="D"> <span>D. 手动设置通信参数</span></label>
    </div>
  </div>

  <!-- 题目20 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">20. EE-W 系列产品相比传统产品，在节能方面的优势主要体现在哪里？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q20" value="A"> <span>A. 采用新型的制冷技术</span></label>
      <label class="option"><input type="radio" name="q20" value="B"> <span>B. 优化控制逻辑，降低设备运行能耗</span></label>
      <label class="option"><input type="radio" name="q20" value="C"> <span>C. 减少设备数量</span></label>
      <label class="option"><input type="radio" name="q20" value="D"> <span>D. 增加设备功率</span></label>
    </div>
  </div>
  <!-- 题目21 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">21. EE-W 系列产品在安装阶段的优势不包括以下哪项？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q21" value="A"> <span>A. 低风险安装</span></label>
      <label class="option"><input type="radio" name="q21" value="B"> <span>B. 避免启动延迟</span></label>
      <label class="option"><input type="radio" name="q21" value="C"> <span>C. 增加安装成本</span></label>
      <label class="option"><input type="radio" name="q21" value="D"> <span>D. 减少现场安装时间</span></label>
    </div>
  </div>

  <!-- 题目22 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">22. EE-W 系列产品在运维阶段，相对于手动控制机房，能降低多少运营风险？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q22" value="A"> <span>A. 10% - 20%</span></label>
      <label class="option"><input type="radio" name="q22" value="B"> <span>B. 20% - 40%</span></label>
      <label class="option"><input type="radio" name="q22" value="C"> <span>C. 40% - 60%</span></label>
      <label class="option"><input type="radio" name="q22" value="D"> <span>D. 60% - 80%</span></label>
    </div>
  </div>

  <!-- 题目23 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">23. EE-W 系列产品在现有可变一次流量冷冻机房中，最多可减少多少用水量？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q23" value="A"> <span>A. 8%</span></label>
      <label class="option"><input type="radio" name="q23" value="B"> <span>B. 10%</span></label>
      <label class="option"><input type="radio" name="q23" value="C"> <span>C. 12%</span></label>
      <label class="option"><input type="radio" name="q23" value="D"> <span>D. 15%</span></label>
    </div>
  </div>

  <!-- 题目24 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">24. EE-W 系列产品在改造后的投资回报期通常是多久？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q24" value="A"> <span>A. 不到 1 年</span></label>
      <label class="option"><input type="radio" name="q24" value="B"> <span>B. 1 - 2 年</span></label>
      <label class="option"><input type="radio" name="q24" value="C"> <span>C. 2 - 3 年</span></label>
      <label class="option"><input type="radio" name="q24" value="D"> <span>D. 3 - 5 年</span></label>
    </div>
  </div>

  <!-- 题目25 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">25. EE-W 系列产品在确保设备和系统运行符合设计意图方面，主要通过什么方式？</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="radio" name="q25" value="A"> <span>A. 定期人工检查</span></label>
      <label class="option"><input type="radio" name="q25" value="B"> <span>B. 优化控制逻辑和远程支持</span></label>
      <label class="option"><input type="radio" name="q25" value="C"> <span>C. 增加设备监测点</span></label>
      <label class="option"><input type="radio" name="q25" value="D"> <span>D. 更换设备部件</span></label>
    </div>
  </div>
            </div>
        </div>

        <!-- 多选题 -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm mb-8">
            <h2 class="text-xl font-semibold mb-6 text-gray-800 dark:text-gray-200">
                <i class="fas fa-tasks mr-2 text-green-500"></i>多选题（每题1分，共20分）
            </h2>
            <div class="space-y-6">
                 <!-- 题目1 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">1. EE-W 系列产品的应用场合包括（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq1" value="A"> <span>A. 舒适制冷系统</span></label>
      <label class="option"><input type="checkbox" name="mq1" value="B"> <span>B. 工艺制冷系统</span></label>
      <label class="option"><input type="checkbox" name="mq1" value="C"> <span>C. 风冷式冷冻机房</span></label>
      <label class="option"><input type="checkbox" name="mq1" value="D"> <span>D. 水冷式一次变流量冷冻机房</span></label>
    </div>
  </div>

  <!-- 题目2 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">2. EE-W 系统不能用于控制什么类型的制冷系统？（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq2" value="A"> <span>A. 水冷</span></label>
      <label class="option"><input type="checkbox" name="mq2" value="B"> <span>B. 风冷</span></label>
      <label class="option"><input type="checkbox" name="mq2" value="C"> <span>C. 多联机</span></label>
      <label class="option"><input type="checkbox" name="mq2" value="D"> <span>D. 热泵</span></label>
    </div>
  </div>

  <!-- 题目3 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">3. EE-W 控制器在控制冷冻机时，会考虑以下哪些因素来计算工作冷冻机的最佳台数？（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq3" value="A"> <span>A. 机房负荷</span></label>
      <label class="option"><input type="checkbox" name="mq3" value="B"> <span>B. 冷冻水温度设定值的差异</span></label>
      <label class="option"><input type="checkbox" name="mq3" value="C"> <span>C. 冷冻机电气负荷</span></label>
      <label class="option"><input type="checkbox" name="mq3" value="D"> <span>D. 冷冻机高流量状态</span></label>
    </div>
  </div>
  
  <!-- 题目4 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">4. EE-W 系列产品中，与隔离阀接口相关的操作有（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq4" value="A"> <span>A. 利用数字输出打开和关闭阀门</span></label>
      <label class="option"><input type="checkbox" name="mq4" value="B"> <span>B. 利用数字输入获得阀门启/闭状态反馈</span></label>
      <label class="option"><input type="checkbox" name="mq4" value="C"> <span>C. 调节隔离阀的流量大小</span></label>
      <label class="option"><input type="checkbox" name="mq4" value="D"> <span>D. 根据控制逻辑控制隔离阀的动作</span></label>
    </div>
  </div>

  <!-- 题目5 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">5. EE-W 控制器在变流量一次泵控制方面的特点包括（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq5" value="A"> <span>A. 若选用 Armstrong DE 泵，根据各泵的最佳效率点计算工作泵组合</span></label>
      <label class="option"><input type="checkbox" name="mq5" value="B"> <span>B. 依据一台工作冷冻机配一台泵的模式（非 DE 泵时）</span></label>
      <label class="option"><input type="checkbox" name="mq5" value="C"> <span>C. 配有区域传感器时，依据区域差压或温度传感器信号决定泵速</span></label>
      <label class="option"><input type="checkbox" name="mq5" value="D"> <span>D. 通过调节维持冷冻机流量在设定范围内</span></label>
    </div>
  </div>

  <!-- 题目6 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">6. EE-W 控制器的主要控制逻辑涉及（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq6" value="A"> <span>A. 基于需求大小控制冷冻机台数</span></label>
      <label class="option"><input type="checkbox" name="mq6" value="B"> <span>B. 冷冻机顺序控制</span></label>
      <label class="option"><input type="checkbox" name="mq6" value="C"> <span>C. 变流量一次泵控制</span></label>
      <label class="option"><input type="checkbox" name="mq6" value="D"> <span>D. 区域信号监控与旁通阀调节</span></label>
    </div>
  </div>
  <!-- 题目7 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">7. EE-W 系列产品在控制冷冻机顺序时，会依据以下哪些信息？（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq7" value="A"> <span>A. 机房负荷</span></label>
      <label class="option"><input type="checkbox" name="mq7" value="B"> <span>B. 冷冻水温度设定值的差异</span></label>
      <label class="option"><input type="checkbox" name="mq7" value="C"> <span>C. 冷冻机电气负荷</span></label>
      <label class="option"><input type="checkbox" name="mq7" value="D"> <span>D. 冷冻机高流量状态</span></label>
    </div>
  </div>

  <!-- 题目8 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">8. EE-W 控制器与外部 BMS 设备通信支持的协议有（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq8" value="A"> <span>A. Modbus</span></label>
      <label class="option"><input type="checkbox" name="mq8" value="B"> <span>B. BACnet</span></label>
      <label class="option"><input type="checkbox" name="mq8" value="C"> <span>C. Lonworks</span></label>
      <label class="option"><input type="checkbox" name="mq8" value="D"> <span>D. 其他特定行业协议</span></label>
    </div>
  </div>

  <!-- 题目9 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">9. EE-W 系列产品在控制变流量一次泵的泵速时，在不同条件下的依据包括（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq9" value="A"> <span>A. 区域差压传感器信号</span></label>
      <label class="option"><input type="checkbox" name="mq9" value="B"> <span>B. 区域温度传感器信号</span></label>
      <label class="option"><input type="checkbox" name="mq9" value="C"> <span>C. 机房就地差压传感器控制模式下的控制曲线</span></label>
      <label class="option"><input type="checkbox" name="mq9" value="D"> <span>D. 选用 Armstrong DE 泵时的特定控制模式</span></label>
    </div>
  </div>

  <!-- 题目10 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">10. EE-W 系列产品的控制范围涵盖（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq10" value="A"> <span>A. 等大主机最多 5 台</span></label>
      <label class="option"><input type="checkbox" name="mq10" value="B"> <span>B. 等大水泵最多 5 台（含备用泵）</span></label>
      <label class="option"><input type="checkbox" name="mq10" value="C"> <span>C. 相同冷却水泵最多 2 组</span></label>
      <label class="option"><input type="checkbox" name="mq10" value="D"> <span>D. 相同冷却塔最多 2 组</span></label>
    </div>
  </div>

  <!-- 题目11 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">11. EE-W 系列产品在控制冷冻机房设备时，对于不同品牌冷冻机的通信方式有（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq11" value="A"> <span>A. 通过预先列出的 Modbus 协议映射</span></label>
      <label class="option"><input type="checkbox" name="mq11" value="B"> <span>B. 通过预先列出的 BACnet 协议映射</span></label>
      <label class="option"><input type="checkbox" name="mq11" value="C"> <span>C. 手动设置通信参数</span></label>
      <label class="option"><input type="checkbox" name="mq11" value="D"> <span>D. 通过预先列出的 Lonworks 协议映射</span></label>
    </div>
  </div>
  <!-- 题目12 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">12. EE-W 控制器在维持冷冻机流量设定值时使用的控制方式包括（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq12" value="A"> <span>A. 泵启停</span></label>
      <label class="option"><input type="checkbox" name="mq12" value="B"> <span>B. 泵变频</span></label>
      <label class="option"><input type="checkbox" name="mq12" value="C"> <span>C. 手动调节阀门</span></label>
      <label class="option"><input type="checkbox" name="mq12" value="D"> <span>D. PID 调节逻辑</span></label>
    </div>
  </div>

  <!-- 题目13 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">13. EE-W 控制器适用于以下哪些类型的冷冻机房系统？（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq13" value="A"> <span>A. 舒适制冷系统</span></label>
      <label class="option"><input type="checkbox" name="mq13" value="B"> <span>B. 工艺制冷系统</span></label>
      <label class="option"><input type="checkbox" name="mq13" value="C"> <span>C. 风冷热泵机房系统</span></label>
      <label class="option"><input type="checkbox" name="mq13" value="D"> <span>D. 水冷变流量冷冻机房系统</span></label>
    </div>
  </div>

  <!-- 题目14 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">14. EE-W 系列产品可通过以下哪些方式与不同品牌冷冻机实现通讯控制？（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq14" value="A"> <span>A. Modbus</span></label>
      <label class="option"><input type="checkbox" name="mq14" value="B"> <span>B. BACnet</span></label>
      <label class="option"><input type="checkbox" name="mq14" value="C"> <span>C. LonWorks</span></label>
      <label class="option"><input type="checkbox" name="mq14" value="D"> <span>D. RS485 模拟信号</span></label>
    </div>
  </div>

  <!-- 题目15 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">15. EE-W 系列产品在机房改造阶段可带来的优势有（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq15" value="A"> <span>A. 降低施工周期</span></label>
      <label class="option"><input type="checkbox" name="mq15" value="B"> <span>B. 提高能效控制能力</span></label>
      <label class="option"><input type="checkbox" name="mq15" value="C"> <span>C. 降低调试工作量</span></label>
      <label class="option"><input type="checkbox" name="mq15" value="D"> <span>D. 增加人工控制干预</span></label>
    </div>
  </div>

  <!-- 题目16 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">16. 以下哪些属于 EE-W 系统的组成模块或功能？（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq16" value="A"> <span>A. 主控制模块</span></label>
      <label class="option"><input type="checkbox" name="mq16" value="B"> <span>B. 通信模块</span></label>
      <label class="option"><input type="checkbox" name="mq16" value="C"> <span>C. 传感器模块</span></label>
      <label class="option"><input type="checkbox" name="mq16" value="D"> <span>D. 电动机保护模块</span></label>
    </div>
  </div>
  <!-- 题目17 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">17. 以下哪些情况会影响 EE-W 控制器的运行效果？（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq17" value="A"> <span>A. 传感器安装位置错误</span></label>
      <label class="option"><input type="checkbox" name="mq17" value="B"> <span>B. 控制参数未根据现场调整</span></label>
      <label class="option"><input type="checkbox" name="mq17" value="C"> <span>C. 现场电源电压不稳</span></label>
      <label class="option"><input type="checkbox" name="mq17" value="D"> <span>D. 网络配置异常</span></label>
    </div>
  </div>

  <!-- 题目18 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">18. EE-W 系列产品的典型用户收益包括（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq18" value="A"> <span>A. 节能降耗</span></label>
      <label class="option"><input type="checkbox" name="mq18" value="B"> <span>B. 减少人工调节频率</span></label>
      <label class="option"><input type="checkbox" name="mq18" value="C"> <span>C. 提高系统稳定性</span></label>
      <label class="option"><input type="checkbox" name="mq18" value="D"> <span>D. 增加运营成本</span></label>
    </div>
  </div>

  <!-- 题目19 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">19. 以下哪些属于 EE-W 系统自动化程度带来的价值？（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq19" value="A"> <span>A. 减少人工干预</span></label>
      <label class="option"><input type="checkbox" name="mq19" value="B"> <span>B. 实现按需动态运行</span></label>
      <label class="option"><input type="checkbox" name="mq19" value="C"> <span>C. 保障系统运行安全</span></label>
      <label class="option"><input type="checkbox" name="mq19" value="D"> <span>D. 增加值班人员数量</span></label>
    </div>
  </div>

  <!-- 题目20 -->
  <div class="question-card">
    <p class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-4">20. EE-W 控制系统调试成功的必要前提包括（多选）</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      <label class="option"><input type="checkbox" name="mq20" value="A"> <span>A. 正确的参数配置</span></label>
      <label class="option"><input type="checkbox" name="mq20" value="B"> <span>B. 所有设备已正确接入</span></label>
      <label class="option"><input type="checkbox" name="mq20" value="C"> <span>C. 通信链路畅通</span></label>
      <label class="option"><input type="checkbox" name="mq20" value="D"> <span>D. 系统已上电运行</span></label>
    </div>
  </div>
            </div>
        </div>

        <!-- 判断题 -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm mb-8">
            <h2 class="text-xl font-semibold mb-6 text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle mr-2 text-purple-500"></i>判断题（每题1分，共20分）
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- 题目1 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">1. EE-W10 最多支持 5 台主机控制。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq1" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq1" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>

  <!-- 题目2 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">2. 系统支持风冷机组控制。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq2" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq2" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>

  <!-- 题目3 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">3. 需要手动调节系统隔离阀。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq3" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq3" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>

  <!-- 题目4 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">4. EE-W 控制器支持变流量控制策略。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq4" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq4" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>
  <!-- 题目5 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">5. EE-W 控制系统能够自动判断负载需求并控制设备启停。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq5" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq5" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>

  <!-- 题目6 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">6. EE-W 控制器仅适用于风冷热泵系统。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq6" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq6" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>

  <!-- 题目7 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">7. 传感器的安装位置会影响控制效果。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq7" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq7" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>

  <!-- 题目8 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">8. EE-W 控制系统支持 BACnet/IP 通讯协议。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq8" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq8" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>

  <!-- 题目9 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">9. EE-W 控制器无法调节水泵转速。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq9" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq9" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>
  <!-- 题目10 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">10. EE-W 控制器支持多品牌冷冻机通信控制。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq10" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq10" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>

  <!-- 题目11 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">11. 冷却水泵的分组不影响 EE-W 控制器的运行。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq11" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq11" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>

  <!-- 题目12 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">12. EE-W 控制器可以自动调节旁通阀以维持系统稳定。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq12" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq12" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>

  <!-- 题目13 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">13. EE-W 控制器不支持主从控制逻辑切换。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq13" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq13" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>
  <!-- 题目14 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">14. EE-W 控制器具有故障告警功能，可实时提示异常状态。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq14" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq14" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>

  <!-- 题目15 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">15. EE-W 系统不支持远程监控与维护。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq15" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq15" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>

  <!-- 题目16 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">16. EE-W 控制器在多模块系统中可以实现主从控制切换。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq16" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq16" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>

  <!-- 题目17 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">17. 控制系统调试成功的前提包括设备接入完整、参数配置正确。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq17" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq17" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>

  <!-- 题目18 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">18. EE-W 系统的节能效果不如传统人工控制系统。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq18" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq18" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>
  
  <!-- 题目19 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">19. EE-W 控制器支持控制逻辑和参数的灵活调整以适配现场需求。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq19" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq19" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>

  <!-- 题目20 -->
  <div class="judge-card">
    <p class="font-bold text-gray-800 dark:text-gray-200 mb-3">20. EE-W 控制系统调试成功后不需要任何维护。</p>
    <div class="controls flex gap-4">
      <label class="judge-btn"><input type="radio" name="jq20" value="true"><i class="fas fa-check text-green-500"></i></label>
      <label class="judge-btn"><input type="radio" name="jq20" value="false"><i class="fas fa-times text-red-500"></i></label>
    </div>
  </div>
            </div>
        </div>     
<!-- 简答题 -->
<div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm">
  <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">
    <i class="fas fa-pen mr-2 text-orange-500"></i>简答题（40分）
  </h2>

  <!-- 插入参考图片 -->
  <div class="mb-4 text-center">
  <p class="text-gray-700 dark:text-gray-300 text-left leading-relaxed mb-4">
  请参考下图，完成简答题：<br>
  - 请详细描述三台并联水冷主机的传感器配置方案，包括：<br>
  &nbsp;&nbsp;1. 需要配置的传感器类型及数量<br>
  &nbsp;&nbsp;2. 安装位置要求<br>
  &nbsp;&nbsp;3. 通信连接方式
</p>
    <img src="https://i.stardots.io/armstrong/EE-W-Jianda2.png?width=500&rotate=0&blur=0&quality=50" alt="三台水冷主机高效机房系统图"
         class="rounded-lg shadow-md mx-auto max-w-full border border-gray-300 dark:border-gray-600">
  </div>

  <!-- 答题区 -->
  <textarea id="essay" rows="5"
    class="bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600 rounded p-2 w-full"
    placeholder="请详细描述三台并联水冷主机的传感器配置方案，包括：&#10;1. 需要配置的传感器类型及数量&#10;2. 安装位置要求&#10;3. 通信连接方式"
    required></textarea>
</div>

        <!-- 提交按钮 -->
 <div class="flex justify-center mt-8">
  <button onclick="submitTest()"
    class="relative inline-flex items-center justify-center px-4 py-1.5 bg-gradient-to-r from-green-500 to-emerald-600
           text-white text-sm font-medium rounded-full shadow-md hover:from-emerald-500 hover:to-green-600
           transform hover:scale-105 transition-all duration-300 ease-in-out group overflow-hidden">
    <span class="relative z-10 flex items-center">
      <i class="fas fa-file-export mr-2 text-white text-base"></i>
      提交答卷
    </span>
    <!-- 💫 光晕动画 -->
    <div class="absolute inset-0 bg-white opacity-10 blur-xl group-hover:opacity-20 transition-all duration-500"></div>
  </button>
</div>

<!-- ✅ 这是你的 testPage 页面末尾的提交按钮 -->


    </section>

  <!-- ✅ 完成页：展示答题详情、学员信息、总分评定 -->
<section id="completePage" class="page container mx-auto px-4 py-8 text-center">
  <div id="resultCard" class="bg-white dark:bg-gray-800 rounded-xl p-8 shadow-sm max-w-4xl mx-auto text-left">
    <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200 flex items-center">
      <i class="fas fa-clipboard-check text-green-500 mr-2"></i>答题评估结果
    </h2>

    <!-- 学员信息与分数展示 -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-6 text-sm sm:text-base text-gray-700 dark:text-gray-300 break-words">
      <div class="space-y-2">
        <p><strong>公司名称：</strong><span id="resultCompany">-</span></p>
        <p><strong>姓名：</strong><span id="resultName">-</span></p>
        <p><strong>邮箱：</strong><span id="resultEmail">-</span></p>
        <p><strong>电话：</strong><span id="resultPhone">-</span></p>
      </div>
      <div class="sm:text-right space-y-2">
        <p><strong>提交时间：</strong><span id="resultTime">-</span></p>
        <p><strong>总得分：</strong><span id="resultScore" class="text-green-600 dark:text-green-400 text-xl font-bold">-</span> / 100</p>
        <p><strong>评定等级：</strong><span id="resultLevel" class="font-semibold">-</span></p>
      </div>
    </div>

    <!-- 详细答题列表 -->
    <div class="overflow-x-auto">
      <table class="min-w-[680px] table-auto border border-gray-300 dark:border-gray-600 text-xs sm:text-sm">
        <thead class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200">
          <tr>
            <th class="p-2 border w-20">题型</th>
            <th class="p-2 border w-16">题号</th>
            <th class="p-2 border w-1/4">你的答案</th>
            <th class="p-2 border w-1/4">正确答案</th>
            <th class="p-2 border w-20">得分</th>
          </tr>
        </thead>
        <tbody id="resultTableBody" class="text-gray-700 dark:text-gray-300">
          <!-- JavaScript 渲染内容 -->
        </tbody>
      </table>
    </div>


    <!-- 操作按钮 -->
    <div class="mt-6 text-center">
      <!-- ✅ 返回答题页按钮 -->
      <button onclick="onReturnToTestPage()"
      class="mr-4 px-6 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-full shadow-md transition-all">
      <i class="fas fa-arrow-left mr-2"></i>返回答题页
      </button>

      <button onclick="onStartEvaluationClick()"
        class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-full shadow-md transition-all">
        <i class="fas fa-paper-plane mr-2"></i>开始打分
      </button>
    </div>
  </div>

</section>



 <!--  By Martin 此处是核心函数及功能的代码 开始 -->
 <script>
 // ✅ EE-W 产品培训考试系统脚本（整合版）
 // 包含倒计时、答题收集、评估评分、导出 PDF、发送邮件、动态口令等模块
 
 let remainingTime = 60 * 60; // 考试总时长：60分钟
 let timerInterval = null;
 let isPaused = false;
 let evaluationStarted = false; // ✅ 控制是否已开始评测

 let emailjsReady = false;  // ✅ 状态变量：标记是否已加载成功

 let emailSent = false; // ✅ 全局变量：标记邮件是否已发送成功

 const EMAIL_ENABLED = false; // ✅ 控制是否启用邮件发送功能（调试时设为 false）
  
 // ✅ 动态加载 SDK（更灵活稳定）
function loadEmailJS() {
  return new Promise((resolve, reject) => {
    if (window.emailjs) {
      emailjsReady = true;
      resolve(); // 已加载，无需重复
      return;
    }

    const script = document.createElement('script');
    script.src = "https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js";
    script.async = true;

    script.onload = () => {
      try {
        emailjs.init("LoQCI3C98dk3FgEvj"); // ✅ 替换为你的 Public Key
        emailjsReady = true;
        resolve();
      } catch (e) {
        console.error("[EmailJS] 初始化失败", e);
        reject(e);
      }
    };

    script.onerror = () => {
      console.error("[EmailJS] 加载失败，可能是网络问题");
      reject(new Error("SDK 加载失败"));
    };

    document.head.appendChild(script);
  });
}


 
 // ⏳ 倒计时更新函数
 function updateCountdown() {
   const min = String(Math.floor(remainingTime / 60)).padStart(2, '0');
   const sec = String(remainingTime % 60).padStart(2, '0');
   document.getElementById('countdown').innerText = `${min}:${sec}`;
 }
 
 // ⏱️ 启动倒计时
 function startTimer() {
   if (timerInterval) clearInterval(timerInterval);
   timerInterval = setInterval(() => {
     if (!isPaused) {
       remainingTime--;
       updateCountdown();
       if (remainingTime <= 0) {
         clearInterval(timerInterval);
         isPaused = true;
         document.getElementById('testPage').classList.add('blur-overlay');
         alert('时间已到，考试结束！');
       }
     }
   }, 1000);
 }
 
 // ⏸️ 暂停 / 恢复
 function togglePause() {
   isPaused = !isPaused;
   const testPage = document.getElementById('testPage');
   const pauseBtn = document.getElementById('pauseBtn');
   if (isPaused) {
     testPage.classList.add('blur-overlay');
     pauseBtn.innerHTML = '<i class="fas fa-play mr-1"></i><span>继续</span>';
   } else {
     testPage.classList.remove('blur-overlay');
     pauseBtn.innerHTML = '<i class="fas fa-pause mr-1"></i><span>暂停</span>';
   }
 }

 let hasEnteredBefore = false; // ✅ 是否首次进入标记
function showTestPage() { // ✅ 切换到考试页面，并启动计时器/清除毛玻璃遮罩/显示“暂停”按钮/启动倒计时（仅首次进入）
  // 切换至考试页面
  showPage('testPage');

  // 启动倒计时（仅在首次进入时）
  if (!timerInterval) {
    startTimer(); // ⏱️ 启动 60 分钟倒计时
  }

  // 清除暂停状态
  if (remainingTime > 0) {
    isPaused = false;
    document.getElementById('testPage').classList.remove('blur-overlay');
    document.getElementById('pauseBtn').innerHTML = '<i class="fas fa-pause mr-1"></i>暂停';

    if (hasEnteredBefore) {
      // ✅ 非首次进入，显示遮罩提示
      document.getElementById('countdownCenterOverlay').style.display = 'flex';
    }

    hasEnteredBefore = true; // ✅ 设置为已进入
  }
}

 // 📄 页面切换控制
 function showPage(pageId) {
   document.querySelectorAll('.page').forEach(page => {
     page.classList.remove('active-page');
   });
   document.getElementById(pageId).classList.add('active-page');
   window.scrollTo(0, 0);
   if (pageId === 'homePage' || pageId === 'completePage') {
     isPaused = true;
     document.getElementById('testPage').classList.add('blur-overlay');
   }
 }
 
 document.addEventListener('DOMContentLoaded', updateCountdown);
 
 // 🌙 主题切换
 function initTheme() {
   const isDark = localStorage.getItem('theme') === 'dark' ||
     (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches);
   document.documentElement.classList.toggle('dark', isDark);
   document.getElementById('themeToggle').innerHTML = isDark ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
 }
 document.addEventListener('DOMContentLoaded', () => {
   initTheme();
   document.getElementById('themeToggle').addEventListener('click', () => {
     localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'light' : 'dark');
     initTheme();
   });
 });
 
 // ✅ 答案收集
 function collectAnswers() {
   return {
     userInfo: {
       company: document.getElementById('company').value,
       name: document.getElementById('name').value,
       phone: document.getElementById('phone').value,
       email: document.getElementById('email').value
     },
     singleChoice: Array.from(document.querySelectorAll('input[type="radio"]:checked'))
       .reduce((acc, el) => ({ ...acc, [el.name]: el.value }), {}),
     multipleChoice: Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
       .reduce((acc, el) => {
         const group = el.name.replace('mq', '');
         if (!acc[group]) acc[group] = [];
         acc[group].push(el.value);
         return acc;
       }, {}),
     judgment: Array.from(document.querySelectorAll('.judge-card input[type="radio"]:checked'))
       .reduce((acc, el) => ({ ...acc, [el.name]: el.value }), {}),
     essay: document.getElementById('essay').value
   };
 }
 
 // ✅ 评估评分并渲染完成页
 function renderAssessmentResult(answers) {
   const now = new Date().toLocaleString('zh-CN', { hour12: false });
   document.getElementById('resultCompany').textContent = answers.userInfo.company;
   document.getElementById('resultName').textContent = answers.userInfo.name;
   document.getElementById('resultEmail').textContent = answers.userInfo.email;
   document.getElementById('resultPhone').textContent = answers.userInfo.phone;
   document.getElementById('resultTime').textContent = now;
 
   let totalScore = 0;
   let tbody = document.getElementById('resultTableBody');
   tbody.innerHTML = '';
 
   const createRow = (type, num, your, correct, score) => {
     const row = document.createElement('tr');
     row.innerHTML = `
       <td class="border p-2">${type}</td>
       <td class="border p-2">${num}</td>
       <td class="border p-2">${your}</td>
       <td class="border p-2">${correct}</td>
       <td class="border p-2">${score === 0 ? '✘' : '✔'} ${score}</td>
     `;
     tbody.appendChild(row);
   };
 
   // ✅ 正确答案库
   const correctAnswers = {
     single: ["B", "C", "A", "B", "D", "C", "C", "B", "B", "B", "D", "C", "C", "B", "C", "B", "C", "B", "B", "B", "C", "D", "D", "B", "B"],
     multiple: [["A","B","D"],["C","D"],["A","B","C"],["A","B","D"],["A","B","C","D"],["A","B","C","D"],["A","B","C"],["A","B","C"],["A","B","C","D"],["A","B","C","D"],["A","B","D"],["A","B","D"],["A","B","C","D"],["A","B","C"],["A","B","C"],["A","B","C"],["A","B","C","D"],["A","B","C"],["A","B","C"],["A","B","C","D"]],
     judge: ["true","false","false","true","true","false","true","true","false","true","false","true","false","true","false","true","true","false","true","false"]
   };
 
   // ✅ 单选题（25题 * 2分）
   for (let i = 1; i <= 25; i++) {
     const key = `q${i}`;
     const your = answers.singleChoice[key] || '-';
     const correct = correctAnswers.single[i - 1];
     const score = (your === correct) ? 2 : 0;
     totalScore += score;
     createRow('单选题', i, your, correct, score);
   }
 
   // ✅ 多选题（20题 * 1分）
   for (let i = 1; i <= 20; i++) {
     const key = i.toString();
     const your = answers.multipleChoice[key] || [];
     const correct = correctAnswers.multiple[i - 1];
     const isCorrect = JSON.stringify([...your].sort()) === JSON.stringify([...correct].sort());
     const score = isCorrect ? 1 : 0;
     totalScore += score;
     createRow('多选题', i, your.join(', '), correct.join(', '), score);
   }
 
   // ✅ 判断题（20题 * 1分）
   for (let i = 1; i <= 20; i++) {
     const key = `jq${i}`;
     const your = answers.judgment[key];
     const correct = correctAnswers.judge[i - 1];
     const score = (your === correct) ? 1 : 0;
     totalScore += score;
     createRow('判断题', i, your === 'true' ? '✔ 正确' : your === 'false' ? '✘ 错误' : '-', correct === 'true' ? '✔ 正确' : '✘ 错误', score);
   }
 
   // ✅ 简答题评分逻辑（关键词命中）
let essayScore = 0;
const keywords = ["传感器", "温度", "差压", "数量", "安装位置", "通信"];
const matchCount = keywords.filter(k => answers.essay.includes(k)).length;
if (matchCount >= 5) essayScore = 35;
else if (matchCount >= 3) essayScore = 25;
else if (matchCount >= 1) essayScore = 10;

// ✅ 简答题仅显示用户答案与得分，不显示“正确答案”
const essayRow = document.createElement('tr');
essayRow.innerHTML = `
  <td class="border p-2">简答题</td>
  <td class="border p-2">1</td>
  <td class="border p-2">${answers.essay.slice(0, 30)}...</td>
  <td class="border p-2 text-center text-gray-400 italic">-</td>
  <td class="border p-2">${essayScore === 0 ? '✘' : '✔'} ${essayScore}</td>
`;
tbody.appendChild(essayRow);
totalScore += essayScore;
 
   // ✅ 评定结果显示
   document.getElementById('resultScore').textContent = totalScore;
   document.getElementById('resultLevel').textContent = totalScore >= 80 ? '✅ 合格' : '❌ 不合格';
 }

 // ✅ 导出完成页为 PDF 文件
async function exportResultToPDF(userName = '匿名用户') {
  const completePage = document.getElementById("completePage");

  // ✅ 使用 html2canvas 渲染当前完成页为图片，并插入 PDF 中
  const canvas = await html2canvas(completePage, { scale: 2, useCORS: true });
  const imgData = canvas.toDataURL("image/png");

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("p", "mm", "a4");
  const pageWidth = pdf.internal.pageSize.getWidth();
  const imgProps = pdf.getImageProperties(imgData);
  const pdfHeight = (imgProps.height * pageWidth) / imgProps.width;

  pdf.addImage(imgData, "PNG", 0, 0, pageWidth, pdfHeight);
  pdf.save(`EE-W评测结果_${userName}.pdf`);
}


// ✅ 将答题结果生成 HTML 表格用于插入邮件
function buildEmailHTMLTable(answers) {
  const getRow = (type, index, your, correct, score) => `
    <tr>
      <td>${type}</td>
      <td>${index}</td>
      <td>${your}</td>
      <td>${correct}</td>
      <td>${score}</td>
    </tr>`;

  const rows = [];

  const correctAnswers = {
    single: ["B", "C", "A", "B", "D", "C", "C", "B", "B", "B", "D", "C", "C", "B", "C", "B", "C", "B", "B", "B", "C", "D", "D", "B", "B"],
    multiple: [
      ["A", "B", "D"], ["C", "D"], ["A", "B", "C"], ["A", "B", "D"], ["A", "B", "C", "D"],
      ["A", "B", "C", "D"], ["A", "B", "C"], ["A", "B", "C"], ["A", "B", "C", "D"], ["A", "B", "C", "D"],
      ["A", "B", "D"], ["A", "B", "D"], ["A", "B", "C", "D"], ["A", "B", "C"], ["A", "B", "C"],
      ["A", "B", "C"], ["A", "B", "C", "D"], ["A", "B", "C"], ["A", "B", "C"], ["A", "B", "C", "D"]
    ],
    judge: ["true", "false", "false", "true", "true", "false", "true", "true", "false", "true", "false", "true", "false", "true", "false", "true", "true", "false", "true", "false"]
  };

  // 单选题
  for (let i = 1; i <= 25; i++) {
    const key = `q${i}`;
    const your = answers.singleChoice[key] || "-";
    const correct = correctAnswers.single[i - 1];
    const score = (your === correct) ? 2 : 0;
    rows.push(getRow("单选题", i, your, correct, score));
  }

  // 多选题
  for (let i = 1; i <= 20; i++) {
    const key = i.toString();
    const your = (answers.multipleChoice[key] || []).join(", ");
    const correct = correctAnswers.multiple[i - 1].join(", ");
    const score = (your.split(', ').sort().join(',') === correct.split(', ').sort().join(',')) ? 1 : 0;
    rows.push(getRow("多选题", i, your, correct, score));
  }

  // 判断题
  for (let i = 1; i <= 20; i++) {
    const key = `jq${i}`;
    const your = answers.judgment[key] === "true" ? "✔ 正确" : answers.judgment[key] === "false" ? "✘ 错误" : "-";
    const correct = correctAnswers.judge[i - 1] === "true" ? "✔ 正确" : "✘ 错误";
    const score = answers.judgment[key] === correctAnswers.judge[i - 1] ? 1 : 0;
    rows.push(getRow("判断题", i, your, correct, score));
  }

  // 简答题打分
  const keywords = ["传感器", "温度", "差压", "数量", "安装位置", "通信"];
  const match = keywords.filter(k => answers.essay.includes(k)).length;
  let essayScore = 0;
  if (match >= 5) essayScore = 35;
  else if (match >= 3) essayScore = 25;
  else if (match >= 1) essayScore = 10;
  rows.push(getRow("简答题", 1, answers.essay.slice(0, 20) + "...", "(关键词匹配)", essayScore));

  // 返回完整 HTML 表格
  return `
    <table border="1" cellpadding="6" cellspacing="0" style="border-collapse: collapse; width: 100%;">
      <thead style="background-color: #f3f4f6; color: #111">
        <tr><th>题型</th><th>题号</th><th>你的答案</th><th>正确答案</th><th>得分</th></tr>
      </thead>
      <tbody>${rows.join('')}</tbody>
    </table>`;
}


// ✅ EmailJS 邮件发送
function sendResultEmail(answers) {
  if (!EMAIL_ENABLED) {
    console.log("[调试] 邮件功能已禁用，未执行发送。");
    return;
  }

  if (emailSent) {
    console.log("[调试] 邮件已发送，无需重复发送。");
    return;
  }

  const templateParams = {
    company: answers.userInfo.company,
    user_name: answers.userInfo.name,
    phone: answers.userInfo.phone,
    user_email: answers.userInfo.email,
    timestamp: new Date().toLocaleString('zh-CN', { hour12: false }),
    message: '来自 EE-W 培训系统的评测结果',
    table_html: buildEmailHTMLTable(answers)
  };

  if (!window.emailjs) {
    const script = document.createElement("script");
    script.src = "https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js";
    script.onload = () => {
      emailjs.init("LoQCI3C98dk3FgEvj");
      emailjs.send("service_csl8frv", "template_0v2mqw9", templateParams)
        .then(() => {
          console.log("✅ 邮件发送成功");
          alert('✅ 邮件已成功发送到 RSEC 邮箱！');
          emailSent = true; // ✅ 设置状态，表示已成功发送
        })
        .catch(err => {
          console.error('[EmailJS] 邮件失败', err);
          //alert('⚠️ 邮件发送失败，请将导出的 PDF 手动发送到 RSEC 邮箱：rsec@armstrong.com');
          showEmailResultPopup("❌ 邮件发送失败，是否重新发送？");
        });
    };
    document.head.appendChild(script);
  } else {
    emailjs.init("LoQCI3C98dk3FgEvj");
    emailjs.send("service_csl8frv", "template_0v2mqw9", templateParams)
      .then(() => {
        console.log("✅ 邮件发送成功");
        alert('✅ 邮件已成功发送到 RSEC 邮箱！');
        emailSent = true; // ✅ 设置状态，表示已成功发送
      })
      .catch(err => {
        console.error('[EmailJS] 邮件失败', err);
        //alert('⚠️ 邮件发送失败，请将导出的 PDF 手动发送到 RSEC 邮箱：rsec@armstrong.com');
        showEmailResultPopup("❌ 邮件发送失败，是否重新发送？");
      });
  }
}

// ✅ 提交答卷，只跳转，不执行评测、不导出、不发送邮件
function submitTest() {
  const answers = collectAnswers(); // 📝 收集用户答题数据
  sessionStorage.setItem("userAnswers", JSON.stringify(answers)); // 📦 存储到 sessionStorage，稍后用于评测
  showPage("completePage"); // 📄 跳转到完成页
  renderAnswersOnCompletePage(answers); // ✅ 仅展示答题情况，不显示正确答案与得分
}

// ✅ 渲染完成页上用户提交的答案（不包含正确答案与得分）
function renderAnswersOnCompletePage(answers) {
  const now = new Date().toLocaleString('zh-CN', { hour12: false });

  // 填充用户信息
  document.getElementById("resultCompany").textContent = answers.userInfo.company;
  document.getElementById("resultName").textContent = answers.userInfo.name;
  document.getElementById("resultEmail").textContent = answers.userInfo.email;
  document.getElementById("resultPhone").textContent = answers.userInfo.phone;
  document.getElementById("resultTime").textContent = now;

  // 只列出答题内容，不评判正误
  const tbody = document.getElementById("resultTableBody");
  tbody.innerHTML = ""; // 清空原有行

  const createRow = (type, num, yourAnswer) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td class="border p-2">${type}</td>
      <td class="border p-2">${num}</td>
      <td class="border p-2">${yourAnswer}</td>
      <td class="border p-2 text-gray-400 italic">-</td>
      <td class="border p-2 text-gray-400 italic">-</td>
    `;
    tbody.appendChild(row);
  };

  // 单选题
  for (let i = 1; i <= 25; i++) {
    const key = `q${i}`;
    createRow("单选题", i, answers.singleChoice[key] || "未答");
  }

  // 多选题
  for (let i = 1; i <= 20; i++) {
    const key = i.toString();
    const val = answers.multipleChoice[key] || [];
    createRow("多选题", i, val.join(", ") || "未答");
  }

  // 判断题
  for (let i = 1; i <= 20; i++) {
    const key = `jq${i}`;
    const val = answers.judgment[key];
    const label = val === "true" ? "✔ 正确" : val === "false" ? "✘ 错误" : "未答";
    createRow("判断题", i, label);
  }

  // 简答题
  createRow("简答题", 1, answers.essay.slice(0, 50) + (answers.essay.length > 50 ? "..." : ""));
}

/**
 * ✅ handleExport：考试提交主流程
 * 包含评测、PDF 导出、邮件发送功能（调用 renderAssessmentResult）
 */
 async function handleExport() {
    // 1. 校验必填项
    if (!validateForm()) {
        alert("请完善必填信息和答题内容后再提交！");
        return;
    }

    // 2. 显示 loading 动画（需确保页面中存在 id="loading" 的元素）
    const loading = document.getElementById("loading");
    loading?.classList.remove("hidden");

    try {
        // 3. 模拟延迟，确保 UI 渲染稳定
        await new Promise(resolve => setTimeout(resolve, 300));

        // 4. 收集用户答题
        const answers = collectAnswers();

        // 5. 切换到完成页，开始评测（渲染结果页 + 表格）
        showPage("completePage");
        renderAssessmentResult(answers);
        evaluationStarted = true;

        // 6. 等待 1s，确保完成页加载完毕后再导出 PDF
        setTimeout(() => {
            const completePage = document.getElementById("completePage");
            const userName = answers.userInfo.name || "匿名";
            html2pdf().from(completePage).set({
              margin: [10, 10, 10, 10],
              filename: `EE-W评测结果_${userName}.pdf`,
              image: { type: 'jpeg', quality: 0.98 },
              html2canvas: { scale: 2, useCORS: true },
              jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
              pagebreak: { mode: ['css', 'legacy'] }  // ✅ 自动分页
            }).save().then(() => {
                console.log("[PDF] 导出成功");
            }).catch(err => {
                console.error("[PDF] 导出失败", err);
            });
        }, 1000);

        // 7. 构建邮件参数（含答题结果表格）
        const tableHTML = generateEmailTableHTML(answers);
        const templateParams = {
            company: answers.userInfo.company,
            user_name: answers.userInfo.name,
            phone: answers.userInfo.phone,
            user_email: answers.userInfo.email,
            timestamp: new Date().toLocaleString('zh-CN', { hour12: false }),
            message: '系统自动提交：EE-W产品培训答卷',
            table_html: tableHTML
        };

        // 8. 加载 emailjs 模块（仅加载一次）
        if (!window.emailjs) {
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js';
            script.onload = () => {
                emailjs.init('LoQCI3C98dk3FgEvj');
                emailjs.send('service_csl8frv', 'template_0v2mqw9', templateParams)
                    .then(() => console.log("[EmailJS] 邮件发送成功"))
                    .catch(err => {
                        console.error('[EmailJS] 邮件失败', err);
                        alert('⚠️ 邮件发送失败，请将导出的 PDF 手动发送到 RSEC 邮箱：rsec@armstrong.com');
                        showEmailResultPopup("❌ 邮件发送失败，是否重新发送？");
                      });
            };
            document.head.appendChild(script);
        } else {
            emailjs.init('LoQCI3C98dk3FgEvj');
            emailjs.send('service_csl8frv', 'template_0v2mqw9', templateParams)
                .then(() => console.log("[EmailJS] 邮件发送成功"))
                .catch(err => {
                        console.error('[EmailJS] 邮件失败', err);
                        //alert('⚠️ 邮件发送失败，请将导出的 PDF 手动发送到 RSEC 邮箱：rsec@armstrong.com');
                        showEmailResultPopup("❌ 邮件发送失败，是否重新发送？");
                      });
        }

    } catch (error) {
        console.error("提交失败：", error);
        alert("提交失败，请稍后重试。\n错误信息：" + error.message);
    } finally {
        // 9. 隐藏 loading 动画
        loading?.classList.add("hidden");
    }
}

/**
 * ✅ 表单校验函数：确保所有基本信息与题目都已填写
 * @returns {boolean} 是否通过校验
 */
 // ✅ 临时屏蔽校验逻辑（调试用）
function validateForm() {
  console.warn("[调试模式] 表单验证已跳过");
  return true;
}
// 🔐 弹出动态口令窗口
function promptPasswordAndSend(answers) {
  document.getElementById("passwordModal").classList.remove("hidden");

  // 回调函数：根据用户点击决定是否发送
  window.confirmPassword = async function(sendEmail) {
    const password = document.getElementById("passwordInput").value.trim();
    document.getElementById("passwordModal").classList.add("hidden");

    // 判断口令有效性（默认正确口令：AFT2025）
    const isValid = password === "AFT2025";
    
    // 无论正确与否，导出 PDF
    await exportResultPDF(answers);

    if (sendEmail && isValid) {
      await sendResultEmail(answers);
    } else if (sendEmail && !isValid) {
      alert("❌ 动态口令错误，未发送邮件，仅导出 PDF。");
    } else {
      alert("✅ 已跳过邮件，仅保存本地 PDF。");
    }
  };
}

// 📄 导出完成页为 PDF
async function exportResultPDF(answers) {
  const page = document.getElementById("completePage");
  const user = answers.userInfo.name || "未命名";
  await html2pdf().from(page).set({
    margin: 0,
    filename: `EE-W评测结果_${user}.pdf`,
    image: { type: "jpeg", quality: 0.98 },
    html2canvas: { scale: 2, useCORS: true },
    jsPDF: { unit: "mm", format: "a4", orientation: "portrait" }
  }).save();
}

// 📩 构建邮件发送逻辑
async function sendResultEmail(answers) {
  const tableHTML = generateEmailTableHTML(answers);
  const templateParams = {
    company: answers.userInfo.company,
    user_name: answers.userInfo.name,
    phone: answers.userInfo.phone,
    user_email: answers.userInfo.email,
    timestamp: new Date().toLocaleString("zh-CN", { hour12: false }),
    message: "EE-W产品培训自动提交答卷",
    table_html: tableHTML
  };

  try {
    if (!window.emailjs) {
      await new Promise(resolve => {
        const s = document.createElement("script");
        s.src = "https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js";
        s.onload = resolve;
        document.head.appendChild(s);
      });
    }
    emailjs.init("LoQCI3C98dk3FgEvj");
    await emailjs.send("service_csl8frv", "template_0v2mqw9", templateParams);
    alert("✅ 邮件已成功发送！");
  } catch (err) {
    console.error("[EmailJS] 邮件发送失败：", err);
    //alert("❌ 邮件发送失败，请稍后重试！");
    showEmailResultPopup("❌ 邮件发送失败，是否重新发送？");
  }
}

/**
 * ✅ 封装统一的邮件发送函数，自动加载模块并处理回调
 */
function sendEmailWithTemplate(templateParams, onSuccess = null, onFailure = null) {
  const serviceID = 'service_csl8frv';
  const templateID = 'template_0v2mqw9';
  const publicKey = 'LoQCI3C98dk3FgEvj';

  if (typeof emailjs === 'undefined') {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js';
    script.onload = () => {
      emailjs.init(publicKey);
      emailjs.send(serviceID, templateID, templateParams)
        .then(() => {
          console.log('[EmailJS] 邮件发送成功');
          alert("✅ 评测结果已成功发送至 RSEC 邮箱！");
          if (typeof onSuccess === 'function') onSuccess();
        })
        .catch(err => {
          console.error('[EmailJS] 邮件发送失败:', err);
          showEmailResultPopup("❌ 邮件发送失败，是否重新发送？");
          if (typeof onFailure === 'function') onFailure(err);
        });
    };
    script.onerror = () => {
      console.error('[EmailJS] 模块加载失败');
      if (typeof onFailure === 'function') onFailure(new Error('模块加载失败'));
    };
    document.head.appendChild(script);
  } else {
    emailjs.init(publicKey);
    emailjs.send(serviceID, templateID, templateParams)
      .then(() => {
        console.log('[EmailJS] 邮件发送成功');
        alert("✅ 评测结果已成功发送至 RSEC 邮箱！");
        if (typeof onSuccess === 'function') onSuccess();
      })
      .catch(err => {
        console.error('[EmailJS] 邮件发送失败:', err);
        showEmailResultPopup("❌ 邮件发送失败，是否重新发送？");
        if (typeof onFailure === 'function') onFailure(err);
      });
  }
}

/**
 * ✅ 将用户答题结果生成 HTML 表格，用于插入邮件正文中
 * @param {Object} answers - 用户答题数据结构（由 collectAnswers() 返回）
 * @returns {string} HTML 字符串，包含所有答题表格
 */
 function generateEmailTableHTML(answers) {
  let html = `
  <style>
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; font-family: sans-serif; font-size: 14px; }
    th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: center; }
    thead { background-color: #f3f4f6; color: #111827; }
    .title { background-color: #ef4444; color: white; font-weight: bold; }
  </style>

  <h2 style="margin-top: 0;">📋 答题评估结果</h2>
  <p><strong>公司名称：</strong>${answers.userInfo.company}</p>
  <p><strong>姓名：</strong>${answers.userInfo.name}</p>
  <p><strong>邮箱：</strong>${answers.userInfo.email}</p>
  <p><strong>电话：</strong>${answers.userInfo.phone}</p>
  <p><strong>提交时间：</strong>${new Date().toLocaleString('zh-CN', { hour12: false })}</p>
  `;

  const correctAnswers = {
    single: ["B", "C", "A", "B", "D", "C", "C", "B", "B", "B", "D", "C", "C", "B", "C", "B", "C", "B", "B", "B", "C", "D", "D", "B", "B"],
    multiple: [
      ["A", "B", "D"], ["C", "D"], ["A", "B", "C"], ["A", "B", "D"], ["A", "B", "C", "D"],
      ["A", "B", "C", "D"], ["A", "B", "C"], ["A", "B", "C"], ["A", "B", "C", "D"], ["A", "B", "C", "D"],
      ["A", "B", "D"], ["A", "B", "D"], ["A", "B", "C", "D"], ["A", "B", "C"], ["A", "B", "C"],
      ["A", "B", "C"], ["A", "B", "C", "D"], ["A", "B", "C"], ["A", "B", "C"], ["A", "B", "C", "D"]
    ],
    judge: ["true", "false", "false", "true", "true", "false", "true", "true", "false", "true", "false", "true", "false", "true", "false", "true", "true", "false", "true", "false"]
  };

  // 渲染每类题型表格
  const appendTable = (type, count, getUser, getCorrect, getScore) => {
    let rows = '';
    for (let i = 1; i <= count; i++) {
      const your = getUser(i);
      const correct = getCorrect(i);
      const score = getScore(i);
      rows += `<tr>
        <td>${type}</td>
        <td>${i}</td>
        <td>${your}</td>
        <td>${correct}</td>
        <td>${score}</td>
      </tr>`;
    }
    html += `
      <table>
        <thead class="title"><tr><th colspan="5">${type}</th></tr></thead>
        <thead><tr><th>题型</th><th>题号</th><th>你的答案</th><th>正确答案</th><th>得分</th></tr></thead>
        <tbody>${rows}</tbody>
      </table>`;
  };

  // 单选题
  appendTable("单选题", 25,
    i => answers.singleChoice[`q${i}`] || '未答',
    i => correctAnswers.single[i - 1],
    i => (answers.singleChoice[`q${i}`] === correctAnswers.single[i - 1]) ? 2 : 0
  );

  // 多选题
  appendTable("多选题", 20,
    i => (answers.multipleChoice[i] || []).join(', ') || '未答',
    i => correctAnswers.multiple[i - 1].join(', '),
    i => {
      const your = (answers.multipleChoice[i] || []).sort();
      const correct = correctAnswers.multiple[i - 1].sort();
      return JSON.stringify(your) === JSON.stringify(correct) ? 1 : 0;
    }
  );

  // 判断题
  appendTable("判断题", 20,
    i => {
      const v = answers.judgment[`jq${i}`];
      return v === 'true' ? '✔ 正确' : v === 'false' ? '✘ 错误' : '未答';
    },
    i => correctAnswers.judge[i - 1] === 'true' ? '✔ 正确' : '✘ 错误',
    i => (answers.judgment[`jq${i}`] === correctAnswers.judge[i - 1]) ? 1 : 0
  );

  // 简答题
  const essay = answers.essay || '';
  const keywords = ["传感器", "温度", "差压", "数量", "安装位置", "通信"];
  const match = keywords.filter(k => essay.includes(k)).length;
  const essayScore = match >= 5 ? 35 : match >= 3 ? 25 : match >= 1 ? 10 : 0;
  html += `
    <table>
      <thead class="title"><tr><th colspan="5">简答题</th></tr></thead>
      <tbody><tr><td colspan="5" style="text-align: left;">${essay || '未作答'}<br/><strong>得分：</strong>${essayScore}（匹配关键词：${match}）</td></tr></tbody>
    </table>`;

  return html;
}
/**
 * ✅ 补充按钮功能：点击“发送评估结果到邮箱”时触发
 * - 自动导出完成页 PDF
 * - 构建邮件表格内容并通过 EmailJS 发送
 */
async function handleScreenshotAndEmail() {
  try {
    const answers = collectAnswers(); // ✅ 获取当前答题内容（你已实现该函数）
    const userName = answers.userInfo.name || '匿名用户';

    // ✅ 使用 html2pdf 导出完成页
    const completePage = document.getElementById("completePage");
    await html2pdf().from(completePage).set({
      margin: 0,
      filename: `EE-W评测结果_${userName}.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2, useCORS: true },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    }).save();

    // ✅ 构建邮件内容
    const tableHTML = generateEmailTableHTML(answers);
    const templateParams = {
      company: answers.userInfo.company,
      user_name: userName,
      phone: answers.userInfo.phone,
      user_email: answers.userInfo.email,
      timestamp: new Date().toLocaleString('zh-CN', { hour12: false }),
      message: '系统自动提交：EE-W产品培训答卷（手动触发）',
      table_html: tableHTML
    };

    // ✅ 发送邮件（EmailJS 方式）
    emailjs.send('service_csl8frv', 'template_0v2mqw9', templateParams)
      .then(() => alert("✅ 邮件已成功发送！"))
      .catch(err => {
        console.error("[EmailJS] 邮件发送失败：", err);
        //alert("❌ 邮件发送失败，请检查网络或稍后再试！");
        showEmailResultPopup("❌ 邮件发送失败，是否重新发送？");
      });

  } catch (err) {
    console.error("[发送错误]：", err);
    alert("❌ 出现错误，无法完成操作，请稍后重试！");
  }
}

/**
 * ✅ 用户点击“开始评测”时，弹出确认框
 */
 function confirmStartEvaluation() {
  if (confirm("您确定开始进行评测吗？\n提交后将自动推送给 Armstrong RSEC 部门，并导出 PDF。")) {
    // ✅ 继续下一步：动态口令验证 + 邮件推送
    const stored = sessionStorage.getItem("userAnswers");
    if (!stored) {
      alert("⚠️ 无法获取答题数据，请重新提交！");
      return;
    }
    const answers = JSON.parse(stored);
    sessionStorage.setItem("hasEvaluated", "true"); // ✅ 设置标志：已评测
    // 👉 执行动态口令验证逻辑（下一步将补充）
    promptPasswordAndSend(answers);
  } else {
    // ❌ 用户取消，什么都不做
    alert("已取消评测，您可继续检查答题内容。");
  }
}

/**
 * ✅ 返回答题页逻辑（仅在未开始评测前可用）
 */
 function returnToTestPage() {
  // 如果已经开始评测，就不允许返回
  if (sessionStorage.getItem('hasEvaluated') === 'true') {
    alert('⚠️ 您已完成评测，带有完成时间的结果已经发送出去，无法返回修改答卷！');
    return;
  }

  // 跳转回 testPage
  showPage('testPage');

  // 清除所有题目答案，只保留学员信息
  document.querySelectorAll('input[type="radio"]:checked, input[type="checkbox"]:checked').forEach(el => el.checked = false);
  document.getElementById('essay').value = '';

  // ✅ 可选：重置滚动到顶部
  window.scrollTo(0, 0);
}

// ✅ 用户点击“开始评测”按钮后的确认提示
function startEvaluationPrompt() {
  // 使用原生 confirm 简洁实现，也可以改为 modal 风格
  const confirmed = confirm("您确定要开始进行评测吗？\n评测后将自动导出 PDF，并发送结果至 Armstrong RSEC。");
  if (confirmed) {
    // 用户点击“是”后，进入动态口令验证流程
    promptPasswordAndSend(); // 下一步定义
  } else {
    // 否则不做任何操作，停留在完成页
    alert("已取消评测操作。您仍可检查答题内容。");
  }
}

// ✅ 点击“开始评测”按钮时的入口
function onStartEvaluationClick() {
  if (confirm("您确定开始进行评测吗？\n\n一旦开始，将无法返回测试页，并会导出 PDF、推送结果到 Armstrong RSEC。")) {
    // 用户点击“是”，继续弹出动态验证码
    promptPasswordAndSend();
  } else {
    // 用户点击“否”，什么也不做
    return;
  }
}

// ✅ 动态验证码验证 + 分支处理
function promptPasswordAndSend() {
  const code = prompt("请输入动态口令（如由 RSEC 部门提供）：");

  if (!code) return alert("未输入验证码，操作已取消。");

  if (code === "AFT2025") {
    // ✅ 验证成功，执行全部逻辑
    const answers = collectAnswers();
    renderAssessmentResult(answers); // 渲染完成页
    exportPDF(answers);              // 导出 PDF
    sendEmailResult(answers);        // 发送邮件
    evaluationStarted = true;
  } else {
    // ❌ 验证失败，只导出 PDF 并提醒
    const answers = collectAnswers();
    evaluationStarted = true;
    renderAssessmentResult(answers);
    exportPDF(answers);
    alert("动态验证码错误，仅导出 PDF，未发送邮件，请联系管理员。");
  }
}

function exportPDF(answers) {
  const userName = answers.userInfo.name || '匿名用户';
  const completePage = document.getElementById("completePage");
  html2pdf().from(completePage).set({
  margin: [10, 10, 10, 10],
  filename: `EE-W评测结果_${userName}.pdf`,
  image: { type: 'jpeg', quality: 0.98 },
  html2canvas: {
    scale: 2,          // 保证清晰
    useCORS: true,
    scrollX: 0,
    scrollY: 0,
    windowWidth: completePage.scrollWidth, // ✨ 加这个
    windowHeight: completePage.scrollHeight // ✨ 加这个
  },
  jsPDF: {
    unit: 'mm',
    format: 'a4',
    orientation: 'portrait'
  }
}).save();
}

function sendEmailResult(answers) {
  const tableHTML = generateEmailTableHTML(answers);

  const templateParams = {
    company: answers.userInfo.company,
    user_name: answers.userInfo.name,
    phone: answers.userInfo.phone,
    user_email: answers.userInfo.email,
    timestamp: new Date().toLocaleString('zh-CN', { hour12: false }),
    message: '系统自动提交：EE-W产品培训答卷',
    table_html: tableHTML
  };

  // ✅ 调用 EmailJS
  emailjs.send('service_csl8frv', 'template_0v2mqw9', templateParams)
    .then(() => {
        console.log("✅ 邮件发送成功");
        alert("✅ 评测结果已成功发送至 RSEC 邮箱！");
      })
    .catch(err => {
        console.error('[EmailJS] 邮件失败', err);
        //alert('⚠️ 邮件发送失败，请将导出的 PDF 手动发送到 RSEC 邮箱：rsec@armstrong.com');
        showEmailResultPopup("❌ 邮件发送失败，是否重新发送？");
      });
}

function onReturnToTestPage() {
  if (evaluationStarted) {
    alert("⚠️ 评测已开始，无法返回答题页！");
    return;
  }

  // ✅ 清除答题内容（保留学员信息）
  const answers = collectAnswers();
  // 清空选项和简答题内容（⚠️ 注释以下两行即可保留答题记录）
  //document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => input.checked = false);
  //document.getElementById('essay').value = '';

  showPage('testPage');
  document.getElementById('company').value = answers.userInfo.company;
  document.getElementById('name').value = answers.userInfo.name;
  document.getElementById('email').value = answers.userInfo.email;
  document.getElementById('phone').value = answers.userInfo.phone;
}

// 🧩 显示邮件重试弹窗
function showRetryModal() {
  document.getElementById("emailRetryModal").classList.remove("hidden");
}

// 🧩 关闭弹窗
function closeRetryModal() {
  document.getElementById("emailRetryModal").classList.add("hidden");
}

// 🧩 点击重试按钮时，重新初始化并推送邮件
document.getElementById("retryEmailBtn").addEventListener("click", () => {
  closeRetryModal();

  // ✅ 重新初始化 EmailJS（防止加载失败或异常）
  if (window.emailjs) {
    try {
      emailjs.init("LoQCI3C98dk3FgEvj");
    } catch (e) {
      console.error("EmailJS 初始化失败", e);
    }
  }

  // ✅ 重新发送邮件（调用你现有的函数）
  handleEmailSendAgain();
});

// ✅ 重新初始化 EmailJS（避免推送失败后卡死）
function reinitializeEmailJS() {
  if (window.emailjs) {
    try {
      emailjs.init("LoQCI3C98dk3FgEvj");  // 你的 Public Key
      console.log("✅ EmailJS 已重新初始化");
    } catch (err) {
      console.error("❌ EmailJS 初始化失败", err);
    }
  } else {
    console.error("⚠️ EmailJS 模块未加载");
  }
}

// ✅ 重试按钮绑定的函数
function retryEmailSend() {
  hideEmailResultPopup();  // 先关闭弹窗
  reinitializeEmailJS();   // 重新初始化
  setTimeout(() => {
    handleExportWithPDFAndEmail(); // 再次执行导出和推送
  }, 200);  // 稍等200ms，避免初始化未完成
}


// ✅ 用于显示邮件发送结果弹窗，并支持重试逻辑
function showEmailResultPopup(message) {
  // 构建弹窗 HTML
  const modalHTML = `
    <div id="emailResultPopup" class="fixed inset-0 bg-black bg-opacity-50 z-[9999] flex items-center justify-center">
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 w-[300px] text-center fade-in-bounce">
        <p class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">${message}</p>
        <div class="flex justify-center gap-4">
          <button id="retrySendBtn" class="bg-blue-600 text-white px-4 py-1.5 rounded hover:bg-blue-700">是</button>
          <button id="cancelSendBtn" class="bg-gray-300 text-gray-800 px-4 py-1.5 rounded hover:bg-gray-400">否</button>
        </div>
      </div>
    </div>
  `;

  // 插入弹窗
  document.body.insertAdjacentHTML('beforeend', modalHTML);

  // ✅ 绑定按钮事件
  document.getElementById('retrySendBtn').onclick = () => {
    document.getElementById('emailResultPopup').remove();

    // ✅ 重初始化 EmailJS（确保状态清空）
    emailjs.init("LoQCI3C98dk3FgEvj");

    // ✅ 重新发送（调用你已有的主发送函数）
    try {
      handleExportWithPDFAndEmail(true); // 加一个参数标识重试
    } catch (err) {
      alert("邮件再次发送失败，请稍后再试。");
    }
  };

  document.getElementById('cancelSendBtn').onclick = () => {
    document.getElementById('emailResultPopup').remove();
  };
}

 </script>
 <!--  By Martin 此处是核心函数及功能的代码 结尾 -->

<script>
// ✅ 随机打乱分布 30° 统一倾斜水印
document.addEventListener("DOMContentLoaded", () => {
  const COUNT = 30; // 水印个数
  for (let i = 0; i < COUNT; i++) {
    const wm = document.createElement("div");
    wm.className = "watermark-random";
    wm.style.top = `${Math.random() * 120 - 10}vh`;
    wm.style.left = `${Math.random() * 120 - 10}vw`;
    wm.style.transform = `rotate(30deg) scale(${0.7 + Math.random() * 0.6})`;
    document.body.appendChild(wm);
  }
});
</script>

<!-- 🔐 动态口令弹窗 -->
<div id="passwordModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
  <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md w-full max-w-sm text-center">
    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">请输入动态口令以发送评测结果至邮箱</h3>
    <input id="passwordInput" type="password" placeholder="请输入口令..." 
           class="w-full p-2 border rounded-md mb-4 focus:outline-none focus:ring focus:border-blue-300" />
    <div class="flex justify-between space-x-4">
      <button onclick="confirmPassword(true)" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded">确定</button>
      <button onclick="confirmPassword(false)" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white py-2 rounded">跳过发送</button>
    </div>
  </div>
</div>

<!-- ✅ 倒计时暂停提示遮罩 -->
<div id="countdownCenterOverlay" class="hidden fixed inset-0 flex">
  <div class="text-center">
    <p>当前考试已暂停</p>
    <p>点击下方按钮可恢复考试</p>
    <button onclick="resumeFromCenterOverlay()">继续答题</button>
  </div>
</div>

<script>
  // ✅ 页面加载后自动触发倒计时函数
  document.addEventListener("DOMContentLoaded", function () {
    startTimer(); // 自动启动倒计时
  });
</script>

<!-- 邮件重试弹窗 -->
<div id="emailRetryModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white dark:bg-gray-800 rounded-xl p-6 w-80 text-center shadow-lg">
    <p class="text-lg font-semibold text-gray-900 dark:text-white mb-4">邮件发送失败，是否重试？</p>
    <div class="flex justify-center gap-4">
      <!-- 邮件失败弹窗按钮 -->
    <button id="retryEmailButton" onclick="retryEmailSend()" class="bg-green-500 hover:bg-green-600 ...">
      是，重新发送
    </button>
    <button id="cancelRetryButton" onclick="hideEmailResultPopup()" class="bg-gray-400 hover:bg-gray-500 ...">
      否，暂不发送
    </button>
    </div>
  </div>
</div>

<!-- ✅ 页面心跳机制脚本（新增） -->
<script>
  let lastActivityTime = Date.now();

  // 记录人工活动
  const recordActivity = () => {
    lastActivityTime = Date.now();
  };

  // 绑定事件
  ['mousemove', 'mousedown', 'keydown', 'scroll', 'touchstart'].forEach(evt => {
    document.addEventListener(evt, recordActivity);
  });

  // 每分钟判断是否需要发心跳
  setInterval(() => {
    const now = Date.now();
    const diff = now - lastActivityTime;
    if (diff < 60000) {
      fetch('/heartbeat').catch(() => {});
    }
  }, 60000);
</script>

</body>
</html>
