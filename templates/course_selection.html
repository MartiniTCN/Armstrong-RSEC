<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Armstrong Training Courses</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {}
            }
        };
    </script>

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }

        .course-card {
            aspect-ratio: 1;
            transition: all 0.3s;
        }
        .course-card:hover {
            transform: scale(1.03) translateY(-4px);
        }
        .course-image {
            transition: transform 0.3s;
        }
        .course-card:hover .course-image {
            transform: scale(1.02);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
    <!-- Navigation Bar -->
    <div class="sticky top-0 z-50 bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl border-b border-gray-200 dark:border-gray-800">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="flex items-center gap-3 w-full sm:w-auto">
                    <img 
                        src="https://i.stardots.io/armstrong/Armstrong%20Logo%20-%20Martin.png?width=200" 
                        alt="Armstrong Logo"
                        class="h-8 object-contain"
                    />
                    
                    <!-- ç«–çº¿åˆ†éš”ç¬¦ -->
                    <span class="text-gray-400 text-xl">|</span>
                    
                    <div class="flex items-center gap-3">
                        <i class="fas fa-book-open w-6 h-6 text-purple-600 dark:text-purple-400"></i>
                        <h1 class="text-xl font-semibold text-gray-900 dark:text-white" id="pageTitle">äº§å“è¯¾ç¨‹</h1>
                    </div>
                </div>
                
                <!-- æœç´¢æ¡†å’Œæ§åˆ¶æŒ‰é’®éƒ¨åˆ† -->
                <div class="flex items-center gap-3 w-full sm:w-auto">
                    <div class="relative flex-1 sm:flex-none sm:min-w-[300px]">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                        <input
                            type="text"
                            id="searchInput"
                            placeholder="æœç´¢è¯¾ç¨‹..."
                            class="w-full pl-10 pr-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white rounded-lg placeholder-gray-400 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        />
                    </div>
                    <select
                        id="categorySelect"
                        class="px-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    >
                        <option value="">æ‰€æœ‰ç±»åˆ«</option>
                    </select>
                    <button
                        id="themeToggle"
                        class="p-2 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                        aria-label="Toggle dark mode"
                    >
                        <i class="fas fa-sun dark:hidden"></i>
                        <i class="fas fa-moon hidden dark:block"></i>
                    </button>
                    <button
                        id="languageToggle"
                        class="p-2 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                    >
                        <img
                            id="languageFlag"
                            src="https://flagcdn.com/cn.svg"
                            alt="Language"
                            class="w-5 h-4"
                        />
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        <div id="courseGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Courses will be dynamically inserted here -->
        </div>
        <div id="noResults" class="hidden text-center py-12">
            <p class="text-lg text-gray-500 dark:text-gray-400">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è¯¾ç¨‹ã€‚</p>
        </div>
    </main>

    <script>
        // Course data
        const courses = [
            {
                id: 1,
                title: {
                    zh: "EE-W æ°´å†·æœºæˆ¿ä¼˜åŒ–æ§åˆ¶",
                    en: "EE-W (IPC9521)"
                },
                description: {
                    zh: "ä¸“ä¸ºé«˜æ•ˆåˆ¶å†·æœºæˆ¿è€Œç”Ÿï¼Œå®ç°æ°´å†·æ°´ä¸»æœºç³»ç»Ÿçš„æ™ºèƒ½ååŒæ§åˆ¶ï¼Œé‡Šæ”¾æœ€ä½³æ€§èƒ½ã€‚",
                    en: "Designed for high-efficiency chiller plants, enabling smart collaboration among chillers to unleash peak performance."
                },
                link: "/course/EE-W" , // âœ… æŒ‡å‘ä½ å®šä¹‰çš„è·¯ç”±
                duration: "8 weeks",
                students: 1234,
                rating: 4.8,
                image: "https://i.stardots.io/armstrong/EE-W.png",
                category: "Optimization"
            },
            {
                id: 2,
                title: {
                    zh: "SE-A ç©ºæ°”æºå†·æ°´æœºç»„ä¼˜åŒ–æ§åˆ¶",
                    en: "SE-A (IPC9511)"
                },
                description: {
                    zh: "ä¸€ä½“åŒ–æ™ºæ§æ ¸å¿ƒï¼Œå®šä¹‰ç©ºæ°”æºå†·æ°´æœºç»„çš„æ–°æ ‡å‡†ã€‚",
                    en: "The integrated brain for air-cooled chillersâ€”simplifying control, maximizing efficiency."
                },
                duration: "12 weeks",
                students: 856,
                rating: 4.7,
                image: "https://i.stardots.io/armstrong/SE-A.png",
                category: "Optimization"
            },
            {
                id: 3,
                title: {
                    zh: "SE-T é«˜æ•ˆå†·å´ç³»ç»Ÿä¼˜åŒ–æ§åˆ¶",
                    en: "SE-T (ITC9521)"
                },
                description: {
                    zh: "èšç„¦å†·å´å¡”ä¸å†·å´æ³µçš„ä¼˜åŒ–æ§åˆ¶ï¼Œæ‰“é€ æ™ºèƒ½æ•£çƒ­æ–°ä½“éªŒã€‚",
                    en: "Focused on optimizing cooling towers and pumps for intelligent heat rejection."
                },
                duration: "6 weeks",
                students: 945,
                rating: 4.9,
                image: "https://i.stardots.io/armstrong/SE-T%20(ITC9521).png",
                category: "Optimization"
            },
            {
                id: 4,
                title: {
                    zh: "SE-F æ™ºèƒ½æ³µç»„ä¼˜åŒ–æ§åˆ¶",
                    en: "SE-F (IPS4xxxx)"
                },
                description: {
                    zh: "å¤šæ³µæ™ºæ§æ ¸å¿ƒï¼Œç³»ç»Ÿæ›´ç¨³æ›´çœã€‚",
                    en: "The smart core for multi-pump controlâ€”stable, efficient, effortless."
                },
                duration: "10 weeks",
                students: 678,
                rating: 4.6,
                image: "https://i.stardots.io/armstrong/SE-F%20(IPS).png",
                category: "Optimization"
            },
            {
                id: 5,
                title: {
                    zh: "DE æ™ºèƒ½å˜é¢‘æ³µ",
                    en: "Design Envelope Pump"
                },
                description: {
                    zh: "ä¸åªæ˜¯æ°´æ³µï¼Œæ›´æ˜¯è‡ªæˆ‘è°ƒèŠ‚çš„æ™ºæ…§å¼•æ“ã€‚å®‰è£…å³è¿è¡Œï¼ŒèŠ‚èƒ½é«˜æ•ˆã€‚",
                    en: "More than a pump â€“ a self-optimizing intelligent engine. quick to install, smart to run, built for energy savings in intelligent buildings."
                },
                duration: "10 weeks",
                students: 1567,
                rating: 4.9,
                image: "https://i.stardots.io/armstrong/DE%20PUMPS.png",
                category: "Design Envelope"
            },
            {
                id: 6,
                title: {
                    zh: "iFMS æ™ºèƒ½æµä½“ç®¡ç†ç³»ç»Ÿ",
                    en: "iFMS - Smart"
                },
                description: {
                    zh: "ä¸€ä½“åŒ–æµçº¿ï¼Œå°†å¤æ‚å·¥ç¨‹è¯¾ç¨‹åŒ–ï¼Œä¸€ç«™å¼äº¤ä»˜é«˜æ•ˆå¯é çš„æ™ºèƒ½æœºæˆ¿ç³»ç»Ÿã€‚",
                    en: "From pump to system, simplifies complex projects into packaged solutions for fast, efficient, and reliable delivery."
                },
                duration: "14 weeks",
                students: 2341,
                rating: 4.8,
                image: "https://i.stardots.io/armstrong/iFMS.png",
                category: "System Integration"
            },
            {
                id: 7,
                title: {
                    zh: "Plumbing Boosterç³»ç»Ÿ",
                    en: "Plumbing 6800Q Booster"
                },
                description: {
                    zh: "æ™ºèƒ½å¢å‹ï¼ŒèŠ‚èƒ½é™éŸ³ï¼Œå åœ°æ›´å°ï¼Œé€‚é…å¤šç§ä¾›æ°´åœºæ™¯ã€‚",
                    en: "Smart boosting with energy savings, quiet operation, and compact footprint for versatile water supply needs."
                },
                duration: "8 weeks",
                students: 1123,
                rating: 4.7,
                image: "https://i.stardots.io/armstrong/Booster.png",
                category: "Plumbing"
            },
            {
                id: 8,
                title: {
                    zh: "æ¿å¼æ¢çƒ­å™¨ç³»ç»Ÿï¼ˆPFXï¼‰",
                    en: "Plate Heat Exchanger (PFX)"
                },
                description: {
                    zh: "ä»¥è¶…è‡´å¯†æ»¡å’Œé«˜æ•ˆæ¢çƒ­ï¼Œé‡Šæ”¾æ¯ä¸€å¯¸æœºæˆ¿ç©ºé—´ï¼Œé€‚ç”¨äºå¯¹èŠ‚èƒ½å’Œä½“ç§¯è¦æ±‚æé«˜çš„æ¥¼å®‡é¡¹ç›®",
                    en: "Ultra-compact and energy-efficient heat transfer that frees up valuable mechanical room spaceâ€”perfect for energy-conscious buildings."
                },
                duration: "9 weeks",
                students: 892,
                rating: 4.8,
                image: "https://i.stardots.io/armstrong/PFX.png",
                category: "Heat Exchange"
            }
        ];

        // Translations
        const translations = {
            en: {
                title: "Training Courses",
                searchPlaceholder: "Search courses...",
                allCategories: "All Categories",
                students: "students",
                noResults: "No courses found matching your criteria.",
                weeks: "weeks"
            },
            zh: {
                title: "åŸ¹è®­è¯¾ç¨‹",
                searchPlaceholder: "æœç´¢è¯¾ç¨‹...",
                allCategories: "æ‰€æœ‰ç±»åˆ«",
                students: "å­¦ç”Ÿ",
                noResults: "æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è¯¾ç¨‹ã€‚",
                weeks: "å‘¨"
            }
        };

        // Current state
        let currentLanguage = 'zh';
        // let isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;

        let isDarkMode = true; // âœ… å¼ºåˆ¶é»˜è®¤æš—è‰²æ¨¡å¼

        // Initialize dark mode
        function initTheme() {
            document.documentElement.classList.toggle('dark', isDarkMode);
        }

    // Create course card
    function createCourseCard(course) {
        console.log("ğŸ“¦ æ¸²æŸ“è¯¾ç¨‹ï¼š", course.title.zh, "â¡ï¸ è·³è½¬ï¼š", course.link);

        return `
            <a href="${course.link || '#'}" class="block group">
            <div class="course-card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl shadow-md overflow-hidden flex flex-col">
                
                <!-- âœ… ä¸ŠåŠéƒ¨åˆ†ï¼šå›¾ç‰‡åŒºåŸŸï¼Œå æ®å¡ç‰‡ä¸€åŠé«˜åº¦ -->
                <div class="h-1/2 bg-gray-100 dark:bg-gray-900 flex items-center justify-center">
                <img 
                    src="${course.image}" 
                    alt="${course.title[currentLanguage]}" 
                    class="course-image w-full h-full object-contain p-4"
                />
                </div>

                <!-- âœ… ä¸‹åŠéƒ¨åˆ†ï¼šæ–‡å­—åŒºåŸŸï¼Œæ”¯æŒç¼©æ”¾ + å†…è¾¹è· -->
                <div class="h-1/2 relative overflow-hidden">
                <!-- âœ… ç¼©æ”¾å®¹å™¨ï¼šä¿æŒå›ºå®šå°ºå¯¸ï¼Œå†…å®¹å¯ç¼©æ”¾ -->
                <div class="scale-inner absolute inset-0 origin-top-left transition-transform duration-300 px-4">
                    
                    <!-- âœ… å†…éƒ¨å®é™…å†…å®¹åŒºåŸŸï¼Œç•™å‡ºå·¦å³è¾¹è· -->
                    <div class="inner-padding flex flex-col justify-between h-full">

                    <!-- âœ… ä¸ŠåŠï¼šæ ‡ç­¾ã€æ ‡é¢˜ã€ç®€ä»‹ -->
                    <div>
                        <!-- âœ… èƒ¶å›Šæ ‡ç­¾ï¼šå°å­—ä½“ + è‡ªé€‚åº”ç¼©æ”¾ + æš—è‰²æ¨¡å¼å…¼å®¹ -->
                        <span class="tag-small mb-1">
                        <span class="tag-text">
                            ${course.category}
                        </span>
                        </span>

                        <!-- æ ‡é¢˜ï¼šåŠ ç²—ï¼Œè‡ªåŠ¨æ¢è¡Œ -->
                        <h3 class="text-sm font-semibold leading-snug text-gray-900 dark:text-white break-words">
                        ${course.title[currentLanguage]}
                        </h3>

                        <!-- ç®€ä»‹ï¼šè¾ƒå°å­—ä½“ã€è‡ªåŠ¨æ¢è¡Œ -->
                        <p class="text-[0.65rem] text-gray-600 dark:text-gray-300 mt-1 break-words">
                        ${course.description[currentLanguage]}
                        </p>
                    </div>

                    <!-- âœ… ä¸‹åŠï¼šæ—¶é•¿ / äººæ•° / è¯„åˆ† -->
                    <!-- åº•éƒ¨å›¾æ ‡æ ï¼ˆâœ… æ·»åŠ  card-footer ç±»ï¼‰ -->
                    <div class="card-footer flex items-center justify-between text-[11px] text-gray-500 dark:text-gray-400 mt-3">
                    <div class="flex items-center gap-1">
                        <i class="fas fa-clock w-3.5 h-3.5"></i><span>${course.duration}</span>
                    </div>
                    <div class="flex items-center gap-1">
                        <i class="fas fa-users w-3.5 h-3.5"></i><span>${course.students.toLocaleString()} ${translations[currentLanguage].students}</span>
                    </div>
                    <div class="flex items-center gap-1">
                        <i class="fas fa-star w-3.5 h-3.5 text-yellow-400"></i><span>${course.rating}</span>
                    </div>
                    </div>

                    </div> <!-- inner-padding end -->
                </div> <!-- scale-inner end -->
                </div> <!-- ä¸‹åŠç»“æŸ -->
            </div>
        </a>
  `;
}

        // Update course grid
        function updateCourseGrid() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const selectedCategory = document.getElementById('categorySelect').value;
            
            const filteredCourses = courses.filter(course => {
                const matchesSearch = 
                    course.title[currentLanguage].toLowerCase().includes(searchTerm) ||
                    course.description[currentLanguage].toLowerCase().includes(searchTerm);
                const matchesCategory = !selectedCategory || course.category === selectedCategory;
                return matchesSearch && matchesCategory;
            });

            const courseGrid = document.getElementById('courseGrid');
            const noResults = document.getElementById('noResults');

            if (filteredCourses.length === 0) {
                courseGrid.innerHTML = '';
                noResults.classList.remove('hidden');
            } else {
                courseGrid.innerHTML = filteredCourses.map(course => createCourseCard(course)).join('');
                noResults.classList.add('hidden');
            }
        }

        // Initialize category select
        function initCategories() {
            const categories = Array.from(new Set(courses.map(course => course.category)));
            const select = document.getElementById('categorySelect');
            select.innerHTML = `
                <option value="">${translations[currentLanguage].allCategories}</option>
                ${categories.map(category => `<option value="${category}">${category}</option>`).join('')}
            `;
        }

        // Update language
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'zh' : 'en';
            document.getElementById('languageFlag').src = `https://flagcdn.com/${currentLanguage === 'en' ? 'cn' : 'us'}.svg`;
            document.getElementById('pageTitle').textContent = translations[currentLanguage].title;
            document.getElementById('searchInput').placeholder = translations[currentLanguage].searchPlaceholder;
            initCategories();
            updateCourseGrid();
            scaleCourseTextAreas(); // è¯­è¨€åˆ‡æ¢åé‡æ–°è®¡ç®—ç¼©æ”¾
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', updateCourseGrid);
        document.getElementById('categorySelect').addEventListener('change', updateCourseGrid);
        document.getElementById('themeToggle').addEventListener('click', () => {
            isDarkMode = !isDarkMode;
            document.documentElement.classList.toggle('dark', isDarkMode);
        });
        document.getElementById('languageToggle').addEventListener('click', toggleLanguage);

        // Initialize
        initTheme();
        initCategories();
        updateCourseGrid();

        // Listen for system dark mode changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            isDarkMode = e.matches;
            document.documentElement.classList.toggle('dark', isDarkMode);
        });
    </script>

    <!-- âœ… é¡µé¢å¿ƒè·³æœºåˆ¶è„šæœ¬ï¼ˆæ–°å¢ï¼‰ -->
    <!-- âœ… é¡µé¢åº•éƒ¨ï¼Œåœ¨ </body> æ ‡ç­¾å‰ -->
    <script>
        let lastActivityTime = Date.now();
    
        // è®°å½•äººå·¥æ“ä½œäº‹ä»¶æ—¶é—´
        const recordActivity = () => {
        lastActivityTime = Date.now();
        };
    
        // âœ… ç»‘å®šæ‰€æœ‰äººå·¥æ“ä½œäº‹ä»¶ï¼ˆç‚¹å‡»ã€æ»šåŠ¨ã€è¾“å…¥ç­‰ï¼‰
        ['mousemove', 'mousedown', 'keydown', 'scroll', 'touchstart'].forEach(evt => {
        document.addEventListener(evt, recordActivity);
        });
    
        // âœ… æ¯åˆ†é’Ÿå‘é€å¿ƒè·³è¯·æ±‚ï¼Œä»…åœ¨ç”¨æˆ·1åˆ†é’Ÿå†…æœ‰æ“ä½œæ—¶æ‰å‘é€
        setInterval(() => {
        if (Date.now() - lastActivityTime < 60000) {
            fetch('/heartbeat')
            .then(res => {
                if (res.status === 440) {
                alert("ç™»å½•å·²è¶…æ—¶ï¼Œè¯·é‡æ–°ç™»å½•ï¼");
                window.location.href = "/login";
                }
            })
            .catch(() => {});
        }
        }, 60000);
    </script>



  
<!-- âœ… ç™»å½•å¼¹çª— -->
<div id="loginOverlay" class="hidden fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center">
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-xs shadow-xl">
      <h2 class="text-lg font-bold text-center mb-4">ä¼šè¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•</h2>
      <input id="reLoginUser" class="w-full mb-3 px-4 py-2 rounded-md bg-gray-100 dark:bg-gray-700" placeholder="ç”¨æˆ·å">
      <input id="reLoginPass" type="password" class="w-full mb-3 px-4 py-2 rounded-md bg-gray-100 dark:bg-gray-700" placeholder="å¯†ç ">
      <button onclick="submitRelogin()" class="w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">é‡æ–°ç™»å½•</button>
    </div>
  </div>

  <!-- é¡µé¢æœ«å°¾ -->
<script>
    function showLoginOverlay() {
      document.getElementById("loginOverlay").classList.remove("hidden");
    }
    
    async function submitRelogin() {
      const username = document.getElementById("reLoginUser").value.trim();
      const password = document.getElementById("reLoginPass").value.trim();
    
      const res = await fetch("/login", {
        method: "POST",
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams({ username, password })
      });
    
      if (res.redirected) {
        location.reload();  // âœ… ç™»å½•æˆåŠŸååˆ·æ–°é¡µé¢ç»§ç»­ä½¿ç”¨
      } else {
        alert("é‡æ–°ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åæˆ–å¯†ç ");
      }
    }

    document.getElementById("reLoginPass").addEventListener("keyup", function (e) {
        if (e.key === "Enter") {
            submitRelogin();
        }
    });
    </script>

    <!-- å…³é—­ç™»å½•å¼¹çª— -->
    <script>
        function closeLoginOverlay() {
            document.getElementById("loginOverlay").classList.add("hidden");
        }
    </script>

<script>
    function scaleCourseTextAreas() {
      const cards = document.querySelectorAll('.course-card');
      cards.forEach(card => {
        const container = card.querySelector('.scale-inner');
        if (!container) return;
  
        container.style.transform = 'scale(1)'; // é‡ç½®ç¼©æ”¾
  
        const textArea = container.parentElement;
        const maxHeight = textArea.clientHeight;
        const actualHeight = container.scrollHeight;
  
        if (actualHeight > maxHeight) {
          const scale = maxHeight / actualHeight;
          container.style.transform = `scale(${scale})`;
        }
      });
    }
  
    window.addEventListener('DOMContentLoaded', scaleCourseTextAreas);
    window.addEventListener('resize', scaleCourseTextAreas);
  </script>

</body>
</html>
