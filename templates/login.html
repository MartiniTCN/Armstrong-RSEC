<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth dark">
<head>
  <link rel="icon" href="https://i.stardots.io/armstrong/Armstrong%20Logo%20-%20Martin.png?width=64" type="image/png">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è§£å†³æ–¹æ¡ˆæ¢ç´¢ä¸è€ƒè¯•ç³»ç»Ÿ</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#2563eb',
          },
          borderRadius: {
            DEFAULT: '1rem',
          },
        }
      }
    }
  </script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- å¼•å…¥ Twemoji åº“ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/twemoji.min.js"></script>

  <style>
    .input-box {
      @apply w-full px-4 py-2 rounded-md bg-white/30 dark:bg-white/10 
             backdrop-blur-md border border-white/10 
             text-white placeholder-white/60 focus:outline-none 
             focus:ring-0 transition;
    }
    
    .input-box:focus {
      @apply bg-white/40 dark:bg-white/20; /* èšç„¦æ—¶èƒŒæ™¯é¢œè‰²ç¨å¾®åŠ æ·± */
    }
  </style>
  
  <style>
    #cnFlag, #ukFlag {
        font-size: 30px;
        vertical-align: middle;
    }
    .shake {
      animation: shake 0.4s ease-in-out;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-8px); }
      40%, 80% { transform: translateX(8px); }
    }
    .animate-fade-in {
      opacity: 0;
      animation: fadeIn 1s ease-out forwards;
    }
    @keyframes fadeIn {
      to { opacity: 1; }
    }
  </style>


<style>
  #registerMessage {
    transition: opacity 0.6s ease, transform 0.3s ease;
    transform: translateY(0);
  }

  #registerMessage.hidden {
    opacity: 0;
    transform: translateY(-10px);
  }
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);  /* æ·»åŠ é˜´å½±è®©æç¤ºæ›´æœ‰ç«‹ä½“æ„Ÿ */
</style>

<!-- âœ… æ¨¡æ€æ¡†æ ·å¼ -->
<style>
  #modal {
    display: flex;
    justify-content: center;
    align-items: center;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
  }

  #modal .bg-white {
    background-color: #fff;
    padding: 20px;
    border-radius: 8px;
    width: 100%;
    max-width: 400px;
    text-align: center;
  }
</style>

</head>
<body class="relative text-gray-900 dark:text-gray-100 transition-colors duration-300"
      style="background-image: url('https://i.stardots.io/armstrong/webpage.jpg'); background-size: cover; background-position: center;">
  <div class="absolute inset-0 bg-white/20 dark:bg-black/30 backdrop-blur-[2px] z-0"></div>
<!-- é¡µé¢åŠ è½½é®ç½© -->
<div id="loadingOverlay" class="fixed inset-0 bg-white dark:bg-gray-900 z-50 flex flex-col items-center justify-center">
  <img src="https://i.stardots.io/armstrong/Armstrong%20Logo%20-%20Martin.png?width=200" alt="Loading..." class="animate-spin-slow w-12 h-12 mb-4">
  <p class="text-gray-700 dark:text-gray-200 text-sm">æ­£åœ¨åŠ è½½ï¼Œè¯·ç¨å€™...</p>
</div>
<!-- æ°´å°å®¹å™¨ 
<div class="watermark-tile" id="watermarkContainer"></div>
-->
<!-- ç™»å½• / æ³¨å†Œ è¡¨å•å¡ç‰‡ -->
<main class="min-h-screen flex items-center justify-center p-4 relative z-10">
  <section
  id="loginCard"
  class="w-full max-w-md bg-white/30 dark:bg-white/10 backdrop-blur-xl border border-white/30 dark:border-white/10 
        rounded-2xl shadow-xl transition-all duration-300 ease-in-out transform
        pt-5 pb-3 px-6 sm:pt-5 sm:pb-3 sm:px-7"
>
  <!-- Logo ä¸æ ‡é¢˜ -->
  <div class="text-center mb-4 animate-fade-in">
    <img alt="Armstrong Logo" class="h-12 mx-auto mb-3" src="https://i.stardots.io/armstrong/Armstrong%20Logo%20-%20Martin.png?width=500"/>
    <h1 class="text-xl font-bold" id="titleText">äº§å“å­¦ä¹ ä¸è¯„æµ‹ç³»ç»Ÿ</h1>
    <p class="text-sm text-gray-500 dark:text-gray-200" id="subtitleText">æœ‰ç›®æ ‡åœ°å­¦ä¹  æœ‰æ´å¯Ÿåœ°è¯„ä¼°</p>
  </div>



  <!-- âœ… ç™»å½•è¡¨å• -->
<form method="post" action="/login" id="loginForm" class="space-y-5">
  <!-- ç™»å½•è¿›åº¦æç¤º -->
  <div id="loginProgress" class="hidden text-center text-gray-500 dark:text-gray-300">
    æ­£åœ¨éªŒè¯ï¼Œè¯·ç¨å€™...
  </div>

  <input type="text" name="username" placeholder="ç”¨æˆ·å" required
  class="w-full px-4 py-2 rounded-md bg-white/10 dark:bg-gray-800/30 backdrop-blur-md
         border border-white/10 text-white placeholder-white/60 focus:outline-none transition
         focus:outline-none focus:ring-0" 
         />
  
  <div class="relative">
    <input type="password" id="password" name="password" placeholder="å¯†ç " required
        class="w-full px-4 py-2 pr-10 rounded-md bg-white/10 dark:bg-gray-800/30 backdrop-blur-md
              border border-white/10 text-white placeholder-white/60 focus:outline-none transition
              focus:outline-none focus:ring-0" 
              />
        <button type="button" onclick="togglePassword()"
            class="absolute right-2 top-1/2 transform -translate-y-1/2 text-white/80 hover:text-white focus:outline-none">
            <i id="passwordIcon" class="fas fa-eye-slash"></i>
          </button>
    </div>      

  <!-- âœ… ç™»å½•å¤±è´¥é”™è¯¯æç¤º -->
  {% if error %}
    <div class="text-sm text-red-500 text-center font-semibold -mt-2">
      {{ error }}
    </div>
  {% endif %}

  <!-- âœ… ç™»å½•+æ³¨å†ŒæŒ‰é’®ç»„ -->
  <div class="flex flex-col items-center mt-4 mb-4">
    <div class="flex justify-center gap-4">
      <!-- ç™»å½•æŒ‰é’® -->
      <button type="submit" id="loginBtn"
        class="px-4 py-1 text-xs text-white rounded-full bg-primary hover:bg-blue-700 transition">
        <span id="loginBtnText">ç™»å½•</span>
      </button>

      <!-- æ³¨å†ŒæŒ‰é’® -->
      <button type="button" onclick="toggleForm('register')"
        class="px-4 py-1 text-xs rounded-full bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-white hover:bg-gray-400 dark:hover:bg-gray-600 transition">
        <span id="registerBtnText">æ³¨å†Œ</span>
      </button>
    </div>
  </div>
</form>
  <!-- âœ… ğŸ‡¨ğŸ‡³è¯­è¨€æŒ‰é’® åœ†å½¢è¯­è¨€æŒ‰é’®è´´è¿‘å³ä¸‹è§’ -->
  <button type="button" onclick="toggleLang()"
  class="absolute bottom-3 right-4 w-4 h-4 rounded-full overflow-hidden shadow hover:scale-110 transition-transform z-20">
  <img id="languageFlag" src="https://flagcdn.com/cn.svg" alt="Language"
    class="w-full h-full object-cover rounded-full">
  </button>

  <!-- âœ… æ³¨å†Œè¡¨å•ï¼ˆé»˜è®¤éšè—ï¼‰ -->
  <form method="post" action="/register" id="registerForm" class="space-y-3 hidden">
    <!-- è¿”å›æŒ‰é’®ï¼Œå·¦ä¸Šè§’ -->
    <div class="absolute top-3 left-4">
      <button type="Back2Login" onclick="toggleForm('login')" class="text-sm text-gray-600 dark:text-gray-300 hover:underline">
        <span id="backToLoginText">â† è¿”å›ç™»å½•</span>
      </button>
    </div>
  
      <input name="username" placeholder="ç”¨æˆ·åï¼ˆå­—æ¯+æ•°å­—ï¼‰" required
        class="w-full px-4 py-2 rounded-md bg-white/10 dark:bg-gray-800/30 backdrop-blur-md
              border border-white/10 text-white placeholder-white/60 focus:outline-none transition
              focus:outline-none focus:ring-0" 
              />
        <div class="relative">
      <input type="password" id="regPassword" name="password" placeholder="å¯†ç " required
        class="w-full px-4 py-2 rounded-md bg-white/10 dark:bg-gray-800/30 backdrop-blur-md
              border border-white/10 text-white placeholder-white/60 focus:outline-none transition
              focus:outline-none focus:ring-0" 
              />
          <button type="button" onclick="togglePassword('regPassword', 'regPwdIcon')"
            class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-300 hover:text-blue-600 focus:outline-none">
            <i id="regPwdIcon" class="fas fa-eye-slash"></i>
          </button>
        </div>
      <input name="company" placeholder="å•ä½åç§°" required
        class="w-full px-4 py-2 rounded-md bg-white/10 dark:bg-gray-800/30 backdrop-blur-md
              border border-white/10 text-white placeholder-white/60 focus:outline-none transition
              focus:outline-none focus:ring-0" 
              />
      <input name="city" placeholder="åŸå¸‚" required
        class="w-full px-4 py-2 rounded-md bg-white/10 dark:bg-gray-800/30 backdrop-blur-md
              border border-white/10 text-white placeholder-white/60 focus:outline-none transition
              focus:outline-none focus:ring-0" 
              />
      <input name="email" placeholder="é‚®ç®±" required
        class="w-full px-4 py-2 rounded-md bg-white/10 dark:bg-gray-800/30 backdrop-blur-md
              border border-white/10 text-white placeholder-white/60 focus:outline-none transition
              focus:outline-none focus:ring-0" 
              />
      <input name="phone" placeholder="ç”µè¯" required
        class="w-full px-4 py-2 rounded-md bg-white/10 dark:bg-gray-800/30 backdrop-blur-md
              border border-white/10 text-white placeholder-white/60 focus:outline-none transition
              focus:outline-none focus:ring-0" 
              />
      <input name="sales_name" placeholder="Armstrong é”€å”®å§“å" required
        class="w-full px-4 py-2 rounded-md bg-white/10 dark:bg-gray-800/30 backdrop-blur-md
              border border-white/10 text-white placeholder-white/60 focus:outline-none transition
              focus:outline-none focus:ring-0" 
              />
      <input name="invite_code" placeholder="é‚€è¯·ç ï¼ˆè¯·è”ç³» RSEC éƒ¨é—¨ï¼‰" required
        class="w-full px-4 py-2 rounded-md bg-white/10 dark:bg-gray-800/30 backdrop-blur-md
              border border-white/10 text-white placeholder-white/60 focus:outline-none transition
              focus:outline-none focus:ring-0" 
              />  
  
    <!-- æ³¨å†ŒæŒ‰é’®ï¼Œå±…ä¸­ -->
    <div class="flex justify-center mt-4 mb-6">
        <button type="submit" onclick="userTriggeredRegister = true"
          class="px-5 py-1.5 text-xs text-white rounded-full bg-primary hover:bg-blue-700 transition">
        <span id="finalRegisterBtnText">æ³¨å†Œ</span>
      </button>
    </div>

    <!-- åœ¨æ³¨å†Œè¡¨å•ä¸‹æ–¹æ·»åŠ ç”¨äºæ˜¾ç¤ºæˆåŠŸæˆ–å¤±è´¥æ¶ˆæ¯çš„ div -->
    <div id="registerMessage" class="hidden text-center font-semibold"></div>

  </form>

</section>
</main>


<!-- âœ… ç™»å½• / æ³¨å†Œ åˆ‡æ¢é€»è¾‘ -->
<script>
  // âœ… åˆ‡æ¢è¡¨å•ï¼ˆç™»å½•ä¸æ³¨å†Œï¼‰
  function toggleForm(type) {
  const loginForm = document.getElementById('loginForm');
  const registerForm = document.getElementById('registerForm');

  if (!loginForm || !registerForm) {
    console.error("Missing loginForm or registerForm in toggleForm.");
    return;
  }

  // æ˜¾ç¤ºæˆ–éšè—è¡¨å•
  loginForm.classList.toggle('hidden', type !== 'login');
  registerForm.classList.toggle('hidden', type !== 'register');

  console.log('Toggle Form:', type);
}

  // âœ… é¡µé¢åŠ è½½æ—¶æ ¹æ® URL å‚æ•°å†³å®šåˆå§‹è¡¨å•
  window.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const formType = urlParams.get('form') || 'login'; // é»˜è®¤æ˜¾ç¤ºç™»å½•è¡¨å•

    if (formType === 'register') {
      toggleForm('register');
    } else {
      toggleForm('login');
    }
  });
</script>

<!-- âœ… ä¸­è‹±æ–‡åˆ‡æ¢è„šæœ¬ -->
<script>
  let isChinese = true; // é»˜è®¤è¯­è¨€ä¸ºä¸­æ–‡

  // âœ… è®¾ç½®è¯­è¨€ï¼ˆè€Œä¸æ˜¯åˆ‡æ¢è¯­è¨€ï¼‰
  function setLang(lang) {
    isChinese = lang;

    // æ›´æ–°æ ‡é¢˜ä¸å‰¯æ ‡é¢˜
    const titleText = document.getElementById('titleText');
    const subtitleText = document.getElementById('subtitleText');
    if (titleText && subtitleText) {
      titleText.textContent = isChinese ? 'äº§å“å­¦ä¹ ä¸è¯„æµ‹ç³»ç»Ÿ' : 'Learning & Evaluation System';
      subtitleText.textContent = isChinese ? 'æœ‰ç›®æ ‡åœ°å­¦ä¹  æœ‰æ´å¯Ÿåœ°è¯„ä¼°' : 'Learn with purpose. Evaluate with insight.';
    }

    // æ›´æ–°è¡¨å•å ä½ç¬¦
    const loginUsername = document.querySelector('#loginForm input[name="username"]');
    const loginPassword = document.querySelector('#loginForm input[name="password"]');
    const registerUsername = document.querySelector('#registerForm input[name="username"]');
    const registerPassword = document.querySelector('#registerForm input[name="password"]');
    const registerCompany = document.querySelector('#registerForm input[name="company"]');
    const registerCity = document.querySelector('#registerForm input[name="city"]');
    const registerEmail = document.querySelector('#registerForm input[name="email"]');
    const registerPhone = document.querySelector('#registerForm input[name="phone"]');
    const registerSalesName = document.querySelector('#registerForm input[name="sales_name"]');
    const registerInviteCode = document.querySelector('#registerForm input[name="invite_code"]');
    const registerSubmitBtn = document.querySelector('#registerForm button[type="submit"]');
    const backToLoginText = document.getElementById("backToLoginText");

    if (loginUsername && loginPassword) {
      loginUsername.placeholder = isChinese ? 'ç”¨æˆ·å' : 'Username';
      loginPassword.placeholder = isChinese ? 'å¯†ç ' : 'Password';
    }

    if (
      registerUsername && registerPassword && registerCompany && registerCity &&
      registerEmail && registerPhone && registerSalesName && registerInviteCode &&
      registerSubmitBtn && backToLoginText
    ) {
      registerUsername.placeholder = isChinese ? 'ç”¨æˆ·åï¼ˆå­—æ¯+æ•°å­—ï¼‰' : 'Username (letters + digits)';
      registerPassword.placeholder = isChinese ? 'å¯†ç ' : 'Password';
      registerCompany.placeholder = isChinese ? 'å•ä½åç§°' : 'Company';
      registerCity.placeholder = isChinese ? 'åŸå¸‚' : 'City';
      registerEmail.placeholder = isChinese ? 'é‚®ç®±' : 'Email';
      registerPhone.placeholder = isChinese ? 'ç”µè¯' : 'Phone';
      registerSalesName.placeholder = isChinese ? 'Armstrong é”€å”®å§“å' : 'Armstrong Sales Name';
      registerInviteCode.placeholder = isChinese ? 'é‚€è¯·ç ï¼ˆè¯·è”ç³» RSEC éƒ¨é—¨ï¼‰' : 'Invite code (Contact China RSEC)';
      registerSubmitBtn.textContent = isChinese ? 'æ³¨å†Œ' : 'Register';
      backToLoginText.textContent = isChinese ? "â† è¿”å›ç™»å½•" : "â† Back";
    }

    // æ›´æ–°è¯­è¨€å›¾æ ‡
    const langFlag = document.getElementById("languageFlag");
    if (langFlag) {
      langFlag.src = isChinese ? 'https://flagcdn.com/cn.svg' : 'https://flagcdn.com/us.svg';
      langFlag.alt = isChinese ? 'ä¸­æ–‡' : 'English';
      langFlag.onerror = function () {
        langFlag.textContent = isChinese ? 'ğŸ‡¨ğŸ‡³' : 'ğŸ‡¬ğŸ‡§';
      };
    }

    // ç™»å½•/æ³¨å†ŒæŒ‰é’®
    const loginBtnText = document.getElementById("loginBtnText");
    const registerBtnText = document.getElementById("registerBtnText");
    if (loginBtnText) loginBtnText.textContent = isChinese ? "ç™»å½•" : "Sign In";
    if (registerBtnText) registerBtnText.textContent = isChinese ? "æ³¨å†Œ" : "Sign Up";

    // ä¿å­˜è¯­è¨€è®¾ç½®
    localStorage.setItem("isChinese", isChinese ? "1" : "0");
  }

  // âœ… åˆ‡æ¢è¯­è¨€
  function toggleLang() {
    setLang(!isChinese);
  }

  // âœ… é¡µé¢åŠ è½½æ—¶ï¼Œä»æœ¬åœ°æ¢å¤è¯­è¨€çŠ¶æ€
  window.addEventListener('DOMContentLoaded', () => {
    const storedLang = localStorage.getItem("isChinese");
    const initialLang = storedLang === null ? true : storedLang === "1";
    setLang(initialLang); // ä¸å†æ˜¯ toggleLang()
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // âœ… 1. æ³¨å†ŒæŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆåˆ‡æ¢åˆ°æ³¨å†Œè¡¨å•ï¼‰
    const registerBtn = document.getElementById('registerBtn');
    if (registerBtn) {
      registerBtn.addEventListener('click', function () {
        toggleForm('register');
      });
    }
  
    // âœ… 2. ç™»å½•å¤±è´¥æ—¶è§¦å‘æŠ–åŠ¨åŠ¨ç”»å¹¶æ¸…ç©ºå¯†ç ï¼ˆæ¥è‡ªåç«¯æ¨¡æ¿å˜é‡ï¼‰
    {% if shake %}
      const card = document.getElementById('loginCard');
      const passwordInput = document.querySelector('#loginForm input[name="password"]');
      if (card) {
        card.classList.remove('shake');
        void card.offsetWidth; // å¼ºåˆ¶åˆ·æ–°
        card.classList.add('shake');
      }
      if (passwordInput) passwordInput.value = '';
    {% endif %}
  
    // âœ… 3. é¡µé¢åŠ è½½åéšè—é®ç½©
    const overlay = document.getElementById('loadingOverlay');
    if (overlay) {
      overlay.style.transition = 'opacity 0.5s';
      overlay.style.opacity = 0;
      setTimeout(() => overlay.style.display = 'none', 500);
    }
  
    // âœ… 4. è°ƒè¯•ï¼šç¡®è®¤æŒ‰é’®å­˜åœ¨æ€§
    const loginBtnText = document.getElementById("loginBtnText");
    const registerBtnText = document.getElementById("registerBtnText");
    if (loginBtnText) console.log("Login button text is available");
    if (registerBtnText) console.log("Register button text is available");
  });
  </script>

<script>
  function togglePassword(inputId = "password", iconId = "passwordIcon") {
    const input = document.getElementById(inputId);
    const icon = document.getElementById(iconId);
    
    if (!input || !icon) return;

    if (input.type === "password") {
      input.type = "text";
      icon.classList.remove("fa-eye-slash");
      icon.classList.add("fa-eye");
    } else {
      input.type = "password";
      icon.classList.remove("fa-eye");
      icon.classList.add("fa-eye-slash");
    }
  }
</script>

<!-- âœ… æ‹¦æˆªæ³¨å†Œè¡¨å•æäº¤å¹¶ä½¿ç”¨ AJAX å¼‚æ­¥æäº¤ -->
<script>
  let userTriggeredRegister = false; // ä»…ç”¨æˆ·ç‚¹å‡»æ³¨å†ŒæŒ‰é’®æ—¶ä¸º true
  
  // âœ… æ³¨å†Œæäº¤é€»è¾‘ï¼ˆé˜²æ­¢éä¸»åŠ¨æäº¤ï¼‰
  document.getElementById('registerForm').addEventListener('submit', async function (e) {
    e.preventDefault();
  
    if (!userTriggeredRegister) return; // ğŸ›‘ é˜»æ­¢éç‚¹å‡»è§¦å‘
    userTriggeredRegister = false;      // âœ… ç«‹åˆ»é‡ç½®æ ‡å¿—
  
    const formData = new FormData(this);
    const data = {};
    formData.forEach((value, key) => data[key] = value);
  
    try {
      const res = await fetch('/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
  
      const result = await res.json();
  
      const toast = document.getElementById("toast");
      const toastMsg = document.getElementById("toastMessage");
      const confirmBtn = document.getElementById("toastConfirmBtn");
  
      if (result.success) {
        // âœ… æ³¨å†ŒæˆåŠŸ - æ˜¾ç¤º toast
        toastMsg.textContent = "âœ… æ³¨å†ŒæˆåŠŸï¼Œè¯·ç¡®è®¤";
        toast.classList.remove("hidden");
  
        // âœ… ç”¨æˆ·ç‚¹å‡»ç¡®è®¤åè·³è½¬å›ç™»å½•è¡¨å•
        confirmBtn.onclick = () => {
          toast.classList.add("hidden");
          toggleForm('login');
  
          // å¯é€‰ï¼šé‡ç½®æç¤ºå†…å®¹ï¼ˆä¿é™©ï¼‰
          toastMsg.textContent = "";
        };
      } else {
        // âŒ æ³¨å†Œå¤±è´¥ - æ˜¾ç¤º toast é”™è¯¯æç¤º
        toastMsg.textContent = "âŒ " + result.message;
        toast.classList.remove("hidden");
  
        // âœ… ç”¨æˆ·ç‚¹å‡»ç¡®è®¤åä»…å…³é—­æç¤º
        confirmBtn.onclick = () => {
          toast.classList.add("hidden");
          toastMsg.textContent = "";
        };
      }
    } catch (err) {
      alert("âš ï¸ ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•");
      console.error(err);
    }
  });
  </script>

<script>
  // âœ… æ‹¦æˆªè¡¨å•æäº¤å¹¶é€šè¿‡ JS å‘èµ·å¼‚æ­¥è¯·æ±‚
  document.getElementById('loginForm').addEventListener('submit', async function(event) {
  event.preventDefault();  // é˜»æ­¢é»˜è®¤æäº¤è¡Œä¸º

  // æ˜¾ç¤ºéªŒè¯æç¤ºæ¡†
  const validationAlert = document.getElementById('validationAlert');
  validationAlert.classList.remove('hidden'); // æ˜¾ç¤ºå¼¹çª—

  const formData = new FormData(this);  // æ”¶é›†è¡¨å•æ•°æ®

  try {
    const response = await fetch('/login', {
      method: 'POST',
      body: formData
    });

    const data = await response.json();

    if (response.ok && data.success) {
      // ç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ°è¯¾ç¨‹é¡µ
      window.location.href = "/course";
    } else {
      // ç™»å½•å¤±è´¥ï¼Œä¿æŒæç¤ºæ¡†æ˜¾ç¤ºï¼Œå¹¶å¼¹å‡ºé”™è¯¯ä¿¡æ¯
      alert(data.message || "ç”¨æˆ·åæˆ–å¯†ç æ— æ•ˆï¼Œè¯·ç¡®è®¤ï¼");
    }
  } catch (error) {
    console.error("ç™»å½•å¼‚å¸¸ï¼š", error);
    alert("ç³»ç»Ÿé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•");
  } finally {
    // éªŒè¯å®Œæˆåéšè—æç¤ºæ¡†
    setTimeout(() => {
      validationAlert.classList.add('hidden'); // éšè—éªŒè¯å¼¹æ¡†
    }, 3000);  // 3ç§’åè‡ªåŠ¨éšè—
  }
});

  // âœ… é¡µé¢åŠ è½½æ—¶éšè—éªŒè¯æç¤ºæ¡†
  window.addEventListener('DOMContentLoaded', () => {
    const validationAlert = document.getElementById('validationAlert');
    if (validationAlert) {
      validationAlert.classList.add('hidden'); // éšè—æç¤ºæ¡†
    }
  });
</script>


<!-- âœ… é¡¶éƒ¨ç¡®è®¤ Toast -->
<div id="toast" class="hidden fixed top-4 left-1/2 transform -translate-x-1/2 z-50
            bg-white/80 dark:bg-gray-800/90 text-black dark:text-white text-sm px-5 py-3 
            rounded-xl shadow-xl backdrop-blur-md border border-gray-300 dark:border-white/10 
            flex items-center gap-4 max-w-[90%]">
  
  <!-- æç¤ºæ–‡å­— -->
  <span id="toastMessage" class="font-semibold">âœ… æ³¨å†ŒæˆåŠŸï¼Œè¯·ç¡®è®¤</span>
  
  <!-- ç¡®è®¤æŒ‰é’® -->
  <button id="toastConfirmBtn" 
          class="ml-auto px-4 py-1 text-xs rounded-full bg-primary text-white hover:bg-blue-700 transition">
    ç¡®è®¤
  </button>
</div>

<script>
  // âœ… åˆ¤æ–­æ˜¯å¦ä¸ºæœ¬åœ°å¼€å‘ç¯å¢ƒ
  const isLocalhost = location.hostname === "localhost" || location.hostname === "127.0.0.1";
  
  // âœ… éæœ¬åœ°ç¯å¢ƒåˆ™å¯ç”¨è°ƒè¯•é˜²æŠ¤
  if (!isLocalhost) {
    // ç¦ç”¨å³é”®èœå•
    document.addEventListener('contextmenu', event => event.preventDefault());
  
    // ç¦ç”¨ F12ã€Ctrl+Shift+I / J / Cã€Ctrl+U ç­‰ç»„åˆé”®
    document.addEventListener('keydown', event => {
      if (
        event.key === 'F12' ||
        (event.ctrlKey && event.shiftKey && ['I', 'J', 'C'].includes(event.key.toUpperCase())) ||
        (event.ctrlKey && event.key.toUpperCase() === 'U')
      ) {
        event.preventDefault();
      }
    });
  }
  </script>

  <!-- éªŒè¯æç¤ºæ¡† -->
<div id="validationAlert" class="hidden fixed top-4 left-1/2 transform -translate-x-1/2 px-4 py-2 text-white bg-blue-500 rounded-lg shadow-lg">
  æ­£åœ¨éªŒè¯ï¼Œè¯·ç¨å€™...
</div>

</body>

<script>
  // é¡µé¢åŠ è½½åç¡®ä¿ modal è¢«éšè—ï¼ˆä¿é™©ï¼‰
  window.addEventListener('DOMContentLoaded', () => {
    userTriggeredRegister = false; // âœ… é¡µé¢ä¸€åŠ è½½å°±æ¸…ç©ºæ³¨å†Œè§¦å‘æ ‡å¿—
    const modal = document.getElementById('modal');
    if (modal) modal.classList.add('hidden');
  });
  const msg = document.getElementById('registerMessage');
    if (msg) {
      msg.classList.add('hidden');
      msg.textContent = ''; // âœ… å½»åº•æ¸…ç©ºä¹‹å‰çš„â€œæ³¨å†ŒæˆåŠŸâ€æ–‡å­—
    }
</script>

</html>
