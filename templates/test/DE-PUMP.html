<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><title>DE-PUMP产品培训测试系统</title><script src=https://cdn.tailwindcss.com></script><script>tailwind.config={darkMode:"class"}</script><link rel=stylesheet href=/static/common/style.css><script src=https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js></script><style>tr{page-break-inside:avoid!important;break-inside:avoid!important}#completePage{width:100%;max-width:800px;margin:0 auto}@media screen and (max-width:768px){#completePage{font-size:13px}table{font-size:12px}td,th{padding:6px 4px;word-break:break-word}}#countdownCenterOverlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,.75);backdrop-filter:blur(6px);z-index:9999;justify-content:center;align-items:center;flex-direction:column;color:#1f2937;font-size:18px}#countdownCenterOverlay button{margin-top:1rem;padding:.5rem 1.5rem;border-radius:9999px;background:#16a34a;color:#fff;font-weight:700;border:none;cursor:pointer}</style><script src=https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js></script><script>function onReturnToTestPage(){if(evaluationStarted)return void alert("⚠️ 评测已开始，无法返回答题页！");const e=collectAnswers();showPage("testPage"),document.getElementById("company").value=e.userInfo.company,document.getElementById("name").value=e.userInfo.name,document.getElementById("email").value=e.userInfo.email,document.getElementById("phone").value=e.userInfo.phone}emailjs.init("LoQCI3C98dk3FgEvj")</script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css><link rel=stylesheet href="{{ url_for('static', filename='common/style.css') }}"><script src=https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js></script><style>@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes spin{to{transform:rotate(360deg)}}.animate-fade-in{animation:fadeIn .3s ease-out}.animate-spin{animation:spin 1s linear infinite}.option-selected{background-color:rgba(59,130,246,.1)}.page{display:none}.active-page{display:block}.option input{@apply mr-3;}.option span{color:#1f2937}.dark .option span{color:#e5e7eb}.judge-btn i{@apply text-xl opacity-0 transition-opacity;}.judge-btn input:checked~i{@apply opacity-100;}.border-red-500{border-color:rgb(239 68 68)!important}.fade-in-bounce{animation:fadeInBounce .5s ease-out}@keyframes fadeInBounce{0%{opacity:0;transform:translateY(-20px)}60%{transform:translateY(10px)}100%{opacity:1;transform:translateY(0)}}.watermark-random{position:fixed;width:220px;height:220px;background-image:url('https://i.stardots.io/armstrong/水印图片 - 金色_副本.png?width=500&rotate=0&blur=0&quality=50');background-repeat:no-repeat;background-size:contain;background-position:center;opacity:.2;z-index:0;pointer-events:none}.blur-overlay{filter:blur(5px);pointer-events:none;user-select:none;transition:all .3s ease}#examStatusBar{position:fixed;top:70px;left:50%;transform:translateX(-50%);background-color:#dc2626;color:#fff;padding:.2rem .5rem;border-radius:9999px;display:flex;justify-content:center;align-items:center;gap:.5rem;font-size:.75rem;font-weight:600;z-index:9999;box-shadow:0 4px 10px rgba(0,0,0,.2);height:auto;line-height:1;transition:all .3s ease}#examStatusBar button{background-color:#fff;color:#dc2626;font-weight:600;padding:.1rem .6rem;border-radius:9999px;font-size:.7rem;line-height:1;transition:all .2s ease}#examStatusBar button:hover{background-color:#fef2f2}#examStatusBar button span{display:none}#examStatusBar button i{margin-right:0}h2[data-title-en],h2[data-title-zh]{font-size:1rem;line-height:1.4;font-weight:600;color:#1f2937}.dark h2[data-title-en],.dark h2[data-title-zh]{color:#e5e7eb}</style></head><body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300"><script>const currentUsername="{{ username }}"</script><div class=page-container><div id=loading class="fixed inset-0 bg-black/50 z-50 hidden"><div class="flex items-center justify-center h-full"><div class="bg-white dark:bg-gray-800 p-6 rounded-lg flex items-center"><i class="fas fa-spinner animate-spin text-2xl text-blue-500 mr-3"></i> <span class="text-gray-700 dark:text-gray-200">正在生成报告...</span></div></div></div><nav id=mainNavbar class="sticky top-0 z-40 w-full bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm"><div class="flex items-center justify-between px-4 py-2 sm:px-6 sm:py-3"><div class="flex items-center gap-2"><img src="https://i.stardots.io/armstrong/Armstrong%20Logo%20-%20Martin.png?width=500" alt=Logo class="h-5 sm:h-8 w-auto"> <span class="text-gray-400 text-xs sm:text-base">｜</span><h1 id=pageTitle data-title-zh="DE-PUMP 产品培训测试系统" data-title-en="DE-PUMP Product Training Test System" class="text-xs sm:text-base font-semibold text-gray-800 dark:text-gray-200 tracking-wide">DE-PUMP 产品培训测试系统</h1></div><div class="flex justify-center gap-4 mt-2 mb-2 items-center"><button id=themeToggle class="w-6 h-6 flex items-center justify-center rounded-full bg-white dark:bg-gray-800 border border-gray-500 dark:border-gray-600 shadow hover:scale-110 transition-transform" aria-label=切换明暗模式><i class="fas fa-sun dark:hidden text-xs"></i> <i class="fas fa-moon hidden dark:block text-xs"></i></button> <button id=languageToggle onclick=toggleLanguage() class="w-4 h-4 flex items-center justify-center rounded-full overflow-hidden bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 shadow-inner hover:scale-110 transition-transform" aria-label=切换语言><img id=languageFlag src=https://flagcdn.com/cn.svg alt=Language class="w-full h-full object-cover"></button> <span class="text-sm font-semibold text-gray-800 dark:text-gray-200">{{ username }} ｜</span><button onclick=handleLogout() id=logoutText class="flex items-center gap-2 hover:underline transition-all text-[#f53029] font-bold py-1 px-2" style=font-size:.85rem;color:#f53029;font-weight:700><i class="fas fa-sign-out-alt" style=font-size:1rem;color:#f53029></i> {{ '退出' if lang == 'zh' else 'Logout' }}</button></div></div></nav><div id=examStatusBar class="mx-auto mt-1 flex items-center justify-center bg-red-600 text-white text-xs sm:text-sm rounded-full shadow-md px-4 py-1 space-x-2 w-fit"><i class="fas fa-clock"></i> <span id=countdown>59:59</span> <button onclick=togglePause() id=pauseBtn class="bg-white text-red-600 px-2 py-0.5 rounded-full hover:bg-red-100 transition"><i class="fas fa-pause"></i> <span class="hidden sm:inline ml-1">暂停</span></button></div><section id=testPage class="page active-page container mx-auto px-4 py-6"><div class="flex justify-between mb-6"><a href=/course class="text-blue-600 dark:text-blue-400 hover:underline"><i class="fas fa-arrow-left mr-2"></i>返回课程选择页</a><div id=errorMessage class="hidden mb-6 px-6 py-4 rounded-lg text-lg font-semibold text-red-700 bg-red-100 border border-red-400 shadow fade-in-bounce flex items-center gap-3"><i class="fas fa-exclamation-triangle"></i> <span id=errorText>请完善信息</span></div><div class="text-gray-600 dark:text-gray-300"><i class="fas fa-clock mr-2"></i>考试时间：60:00</div></div><div class=card><h2 data-title-zh=学员信息 data-title-en="User Info"><i class="fas fa-id-card mr-2 text-blue-500"></i>学员信息</h2><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-bold mb-2 text-gray-700 !dark:text-gray-300" data-zh=公司名称 data-en="Company Name"><span class=text-red-500>*</span> <span class=lang-label>公司名称</span></label><div class=relative><input type=text id=company class="bg-white dark:bg-[#2a2a2a] text-xs placeholder:text-xs text-gray-900 !dark:text-gray-100 border border-gray-300 !dark:border-gray-600 rounded px-3 py-2 pl-10 w-full" placeholder=请输入公司全称 data-placeholder-zh=请输入公司全称 data-placeholder-en="Enter full company name" required> <i class="fas fa-building absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500 text-sm"></i></div></div><div><label class="block text-sm font-bold mb-2 text-gray-700 !dark:text-gray-300" data-zh=学员姓名 data-en="Your Name"><span class=text-red-500>*</span> <span class=lang-label>学员姓名</span></label><div class=relative><input type=text id=name class="bg-white dark:bg-[#2a2a2a] text-xs placeholder:text-xs text-gray-900 !dark:text-gray-100 border border-gray-300 !dark:border-gray-600 rounded px-3 py-2 pl-10 w-full" placeholder=请输入真实姓名 data-placeholder-zh=请输入真实姓名 data-placeholder-en="Enter your name" required> <i class="fas fa-user absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500 text-sm"></i></div></div><div><label class="block text-sm font-bold mb-2 text-gray-700 !dark:text-gray-300" data-zh=手机号码 data-en="Phone Number"><span class=text-red-500>*</span> <span class=lang-label>手机号码</span></label><div class=relative><input type=tel id=phone class="bg-white dark:bg-[#2a2a2a] text-xs placeholder:text-xs text-gray-900 !dark:text-gray-100 border border-gray-300 !dark:border-gray-600 rounded px-3 py-2 pl-10 w-full" placeholder=11位手机号码 data-placeholder-zh=11位手机号码 data-placeholder-en="11-digit phone number" pattern=[0-9]{11} required> <i class="fas fa-phone-alt absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500 text-sm"></i></div></div><div><label class="block text-sm font-bold mb-2 text-gray-700 !dark:text-gray-300" data-zh=邮箱地址 data-en="Email Address"><span class=text-red-500>*</span> <span class=lang-label>邮箱地址</span></label><div class=relative><input type=email id=email class="bg-white dark:bg-[#2a2a2a] text-xs placeholder:text-xs text-gray-900 !dark:text-gray-100 border border-gray-300 !dark:border-gray-600 rounded px-3 py-2 pl-10 w-full" placeholder=name@company.com data-placeholder-zh=name@company.com data-placeholder-en=name@company.com pattern=[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,} required> <i class="fas fa-envelope absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500 text-sm"></i></div></div></div></div><div class="fixed right-2 top-1/3 z-50 bg-white dark:bg-gray-800 rounded shadow p-2 space-y-2 text-xs text-center border border-gray-200 dark:border-gray-700"><button onclick='scrollToType("single")' class="block w-full px-2 py-1 hover:bg-blue-100 dark:hover:bg-gray-700 rounded"><i class="fas fa-list text-sm mr-1"></i> 单选题 <span id=status-single class="ml-1 font-semibold">0 / 0</span></button> <button onclick='scrollToType("multi")' class="block w-full px-2 py-1 hover:bg-purple-100 dark:hover:bg-gray-700 rounded"><i class="fas fa-check-square text-sm mr-1"></i> 多选题 <span id=status-multi class="ml-1 font-semibold">0 / 0</span></button> <button onclick='scrollToType("judge")' class="block w-full px-2 py-1 hover:bg-yellow-100 dark:hover:bg-gray-700 rounded"><i class="fas fa-balance-scale text-sm mr-1"></i> 判断题 <span id=status-judge class="ml-1 font-semibold">0 / 0</span></button> <button onclick='scrollToType("essay")' class="block w-full px-2 py-1 hover:bg-pink-100 dark:hover:bg-gray-700 rounded"><i class="fas fa-keyboard text-sm mr-1"></i> 简答题 <span id=status-essay class="ml-1 font-semibold">0 / 0</span></button></div><div class=card id=section-single><h2 data-title-zh=单选题（每题2分，共40分） data-title-en="Single Choice (2 pts each, 40 pts total)"><i class="fas fa-list-ol mr-2 text-blue-500"></i>单选题（每题2分，共40分）</h2><div class=space-y-6 data-section=single></div></div><div class=card id=section-multi><h2 data-title-zh=多选题（每题1分，共20分） data-title-en="Multiple Choice (1 pts each,20 pts total)"><i class="fas fa-check-square mr-2 text-purple-500"></i>多选题（每题1分，共20分）</h2><div class=space-y-6 data-section=multi></div></div><div class=card id=section-judge><h2 data-title-zh=判断题（每题1分，共20分） data-title-en="True/False (1 pt each, 20 pts total)"><i class="fas fa-balance-scale mr-2 text-yellow-500"></i>判断题（每题1分，共20分）</h2><div class=space-y-6 data-section=judge></div></div><div class=card id=section-essay><h2 data-title-zh=简答题（共1题，20分） data-title-en="Essay Question (1 question, 10 pts)"><i class="fas fa-keyboard mr-2 text-pink-500"></i>简答题（共1题，20分）</h2><div class=space-y-6 data-section=essay></div></div><script>function scrollToType(o){const e=document.querySelector(`[data-section="${o}"]`);if(e){const n="essay"===o?0:-130,t=e.getBoundingClientRect().top+window.scrollY+n;window.scrollTo({top:t,behavior:"smooth"})}else console.warn("❌ 无法找到题型锚点：",o)}</script><div class="flex justify-center mt-8"><button id=submitBtn class="relative inline-flex items-center justify-center px-4 py-1.5 bg-gradient-to-r from-green-500 to-emerald-600 text-white text-sm font-medium rounded-full shadow-md hover:from-emerald-500 hover:to-green-600 transform hover:scale-105 transition-all duration-300 ease-in-out group overflow-hidden"><span class="relative z-10 flex items-center"><i class="fas fa-file-export mr-2 text-white text-base"></i> 提交答卷</span><div class="absolute inset-0 bg-white opacity-10 blur-xl group-hover:opacity-20 transition-all duration-500"></div></button></div></section><section id=completePage class="page container mx-auto px-4 py-8 text-center"><div id=resultCard class="bg-white dark:bg-gray-800 rounded-xl p-8 shadow-sm max-w-4xl mx-auto text-left"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 flex items-center"><i class="fas fa-clipboard-check text-green-500 mr-2"></i>答题评估结果</h2><span class="text-sm font-semibold text-gray-800 dark:text-gray-200 flex items-center space-x-1"><i class="fas fa-user-tie"></i> <span>{{ username }}</span></span></div><div class="bg-white dark:bg-gray-800 shadow rounded-xl p-4 sm:p-6 text-sm mb-6 w-full max-w-3xl mx-auto"><table class="w-full table-fixed text-gray-700 dark:text-gray-200 border-separate border-spacing-y-2"><tbody><tr><td class="w-1/2 pr-4 align-top"><table class=w-full><tr><td colspan=3><span class="inline-flex items-center w-full"><i class="fas fa-building text-gray-500 dark:text-gray-400 text-sm mr-1"></i> <span class="w-24 text-right font-medium">公司名称：</span> <span id=resultCompany class="ml-2 flex-1 text-left">-</span></span></td></tr><tr><td colspan=3><span class="inline-flex items-center w-full"><i class="fas fa-user text-gray-500 dark:text-gray-400 text-sm mr-1"></i> <span class="w-24 text-right font-medium">姓　　名：</span> <span id=resultName class="ml-2 flex-1 text-left">-</span></span></td></tr><tr><td colspan=3><span class="inline-flex items-center w-full"><i class="fas fa-envelope text-gray-500 dark:text-gray-400 text-sm mr-1"></i> <span class="w-24 text-right font-medium">邮　　箱：</span> <span id=resultEmail class="ml-2 flex-1 text-left">-</span></span></td></tr><tr><td colspan=3><span class="inline-flex items-center w-full"><i class="fas fa-phone-alt text-gray-500 dark:text-gray-400 text-sm mr-1"></i> <span class="w-24 text-right font-medium">电　　话：</span> <span id=resultPhone class="ml-2 flex-1 text-left">-</span></span></td></tr></table></td><td class="w-1/2 align-top"><table class=w-full><tr><td colspan=3><span class="inline-flex items-center w-full"><i class="fas fa-clock text-red-500 dark:text-gray-400 text-sm mr-1"></i> <span class="w-24 text-right font-medium">提交时间：</span> <span id=resultTime class="ml-2 flex-1 text-left">-</span></span></td></tr><tr><td colspan=3><span class="inline-flex items-center w-full"><i class="fas fa-percentage text-blue-500 text-sm mr-1"></i> <span class="w-24 text-right font-medium">总&ensp;得&ensp;分：</span> <span id=resultScore class="ml-2 text-green-600 dark:text-green-400 font-bold text-base text-left">-</span></span></td></tr><tr><td colspan=3><span class="inline-flex items-center w-full"><i class="fas fa-bullseye text-green-500 text-sm mr-1"></i> <span class="w-24 text-right font-medium">评定等级：</span> <span id=resultLevel class="ml-2 text-base font-semibold text-left">-</span></span></td></tr></table></td></tr></tbody></table></div><div class=overflow-x-auto><table class="min-w-[680px] table-auto border border-gray-300 dark:border-gray-600 text-xs sm:text-sm"><thead class="bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"><tr><th class="p-2 border w-20">题型</th><th class="p-2 border w-16">题号</th><th class="p-2 border w-1/4">你的答案</th><th class="p-2 border w-1/4">正确答案</th><th class="p-2 border w-20">得分</th></tr></thead><tbody id=resultTableBody class="text-gray-700 dark:text-gray-300"></tbody></table></div><div class="mt-6 text-center"><button onclick=onReturnToTestPage() class="mr-4 px-6 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-full shadow-md transition-all"><i class="fas fa-arrow-left mr-2"></i>返回答题页</button> <button onclick=onStartEvaluationClick() class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-full shadow-md transition-all"><i class="fas fa-paper-plane mr-2"></i>开始打分</button></div></div></section><script>let remainingTime=3600,timerInterval=null,isPaused=!1,evaluationStarted=!1,emailjsReady=!1,emailSent=!1;const EMAIL_ENABLED=!0;function loadEmailJS(){return new Promise(((e,t)=>{if(window.emailjs)return emailjsReady=!0,void e();const n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js",n.async=!0,n.onload=()=>{try{emailjs.init("LoQCI3C98dk3FgEvj"),emailjsReady=!0,e()}catch(e){console.error("[EmailJS] 初始化失败",e),t(e)}},n.onerror=()=>{console.error("[EmailJS] 加载失败，可能是网络问题"),t(new Error("SDK 加载失败"))},document.head.appendChild(n)}))}function updateCountdown(){const e=String(Math.floor(remainingTime/60)).padStart(2,"0"),t=String(remainingTime%60).padStart(2,"0");document.getElementById("countdown").innerText=`${e}:${t}`}function startTimer(){timerInterval&&clearInterval(timerInterval),timerInterval=setInterval((()=>{isPaused||(remainingTime--,updateCountdown(),remainingTime<=0&&(clearInterval(timerInterval),isPaused=!0,document.getElementById("testPage").classList.add("blur-overlay"),alert("时间已到，考试结束！")))}),1e3)}function togglePause(){isPaused=!isPaused;const e=document.getElementById("testPage"),t=document.getElementById("pauseBtn");isPaused?(e.classList.add("blur-overlay"),t.innerHTML='<i class="fas fa-play mr-1"></i><span>继续</span>'):(e.classList.remove("blur-overlay"),t.innerHTML='<i class="fas fa-pause mr-1"></i><span>暂停</span>')}let hasEnteredBefore=!1;function showTestPage(){showPage("testPage"),timerInterval||startTimer(),remainingTime>0&&(isPaused=!1,document.getElementById("testPage").classList.remove("blur-overlay"),document.getElementById("pauseBtn").innerHTML='<i class="fas fa-pause mr-1"></i>暂停',hasEnteredBefore&&(document.getElementById("countdownCenterOverlay").style.display="flex"),hasEnteredBefore=!0)}function showPage(e){document.querySelectorAll(".page").forEach((e=>{e.classList.remove("active-page")})),document.getElementById(e).classList.add("active-page"),window.scrollTo(0,0),"homePage"!==e&&"completePage"!==e||(isPaused=!0,document.getElementById("testPage").classList.add("blur-overlay"))}async function exportResultToPDF(e="匿名用户"){const t=document.getElementById("completePage"),n=(await html2canvas(t,{scale:2,useCORS:!0})).toDataURL("image/png"),{jsPDF:a}=window.jspdf,o=new a("p","mm","a4"),l=o.internal.pageSize.getWidth(),s=o.getImageProperties(n),i=s.height*l/s.width;o.addImage(n,"PNG",0,0,l,i),o.save(`DE-PUMP评测结果_${e}.pdf`)}function buildEmailHTMLTable(e){const t=(e,t,n,a,o)=>`\n    <tr>\n      <td>${e}</td>\n      <td>${t}</td>\n      <td>${n}</td>\n      <td>${a}</td>\n      <td>${o}</td>\n    </tr>`,n=[],a={single:["B","C","A","B","D","C","C","B","B","B","D","C","C","B","C","B","C","B","B","B","C","D","D","B","B"],multiple:[["A","B","D"],["C","D"],["A","B","C"],["A","B","D"],["A","B","C","D"],["A","B","C","D"],["A","B","C"],["A","B","C"],["A","B","C","D"],["A","B","C","D"],["A","B","D"],["A","B","D"],["A","B","C","D"],["A","B","C"],["A","B","C"],["A","B","C"],["A","B","C","D"],["A","B","C"],["A","B","C"],["A","B","C","D"]],judge:["true","false","false","true","true","false","true","true","false","true","false","true","false","true","false","true","true","false","true","false"]};for(let o=1;o<=25;o++){const l=`q${o}`,s=e.singleChoice[l]||"-",i=a.single[o-1],r=s===i?2:0;n.push(t("单选题",o,s,i,r))}for(let o=1;o<=20;o++){const l=o.toString(),s=(e.multipleChoice[l]||[]).join(", "),i=a.multiple[o-1].join(", "),r=s.split(", ").sort().join(",")===i.split(", ").sort().join(",")?1:0;n.push(t("多选题",o,s,i,r))}for(let o=1;o<=20;o++){const l=`jq${o}`,s="true"===e.judgment[l]?"✔ 正确":"false"===e.judgment[l]?"✘ 错误":"-",i="true"===a.judge[o-1]?"✔ 正确":"✘ 错误",r=e.judgment[l]===a.judge[o-1]?1:0;n.push(t("判断题",o,s,i,r))}const o=["传感器","温度","差压","数量","安装位置","通信"].filter((t=>e.essay.includes(t))).length;let l=0;return o>=5?l=35:o>=3?l=25:o>=1&&(l=10),n.push(t("简答题",1,e.essay.slice(0,20)+"...","(关键词匹配)",l)),`\n    <table border="1" cellpadding="6" cellspacing="0" style="border-collapse: collapse; width: 100%;">\n      <thead style="background-color: #f3f4f6; color: #111">\n        <tr><th>题型</th><th>题号</th><th>你的答案</th><th>正确答案</th><th>得分</th></tr>\n      </thead>\n      <tbody>${n.join("")}</tbody>\n    </table>`}function sendResultEmail(e){if(emailSent)return void console.log("[调试] 邮件已发送，无需重复发送。");const t={company:e.userInfo.company,user_name:e.userInfo.name,phone:e.userInfo.phone,user_email:e.userInfo.email,timestamp:(new Date).toLocaleString("zh-CN",{hour12:!1}),message:"来自 DE-PUMP 培训系统的评测结果",table_html:buildEmailHTMLTable(e)};if(window.emailjs)emailjs.init("LoQCI3C98dk3FgEvj"),emailjs.send("service_csl8frv","template_0v2mqw9",t).then((()=>{console.log("✅ 邮件发送成功"),alert("✅ 邮件已成功发送到 RSEC 邮箱！"),emailSent=!0})).catch((e=>{console.error("[EmailJS] 邮件失败",e),showEmailResultPopup("❌ 邮件发送失败，是否重新发送？")}));else{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js",e.onload=()=>{emailjs.init("LoQCI3C98dk3FgEvj"),emailjs.send("service_csl8frv","template_0v2mqw9",t).then((()=>{console.log("✅ 邮件发送成功"),alert("✅ 邮件已成功发送到 RSEC 邮箱！"),emailSent=!0})).catch((e=>{console.error("[EmailJS] 邮件失败",e),showEmailResultPopup("❌ 邮件发送失败，是否重新发送？")}))},document.head.appendChild(e)}}async function handleExport(){if(!validateForm())return void alert("请完善必填信息和答题内容后再提交！");const e=document.getElementById("loading");e?.classList.remove("hidden");try{await new Promise((e=>setTimeout(e,300)));const e=collectAnswers();showPage("completePage"),renderAssessmentResult(e),evaluationStarted=!0,setTimeout((()=>{const t=document.getElementById("completePage"),n=e.userInfo.name||"匿名";html2pdf().from(t).set({margin:[10,10,10,10],filename:`DE-PUMP评测结果_${n}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"},pagebreak:{mode:["css","legacy"]}}).save().then((()=>{console.log("[PDF] 导出成功")})).catch((e=>{console.error("[PDF] 导出失败",e)}))}),1e3);const t=generateEmailTableHTML(e),n={company:e.userInfo.company,user_name:e.userInfo.name,phone:e.userInfo.phone,user_email:e.userInfo.email,timestamp:(new Date).toLocaleString("zh-CN",{hour12:!1}),message:"系统自动提交：DE-PUMP产品培训答卷",table_html:t};if(window.emailjs)emailjs.init("LoQCI3C98dk3FgEvj"),emailjs.send("service_csl8frv","template_0v2mqw9",n).then((()=>console.log("[EmailJS] 邮件发送成功"))).catch((e=>{console.error("[EmailJS] 邮件失败",e),showEmailResultPopup("❌ 邮件发送失败，是否重新发送？")}));else{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js",e.onload=()=>{emailjs.init("LoQCI3C98dk3FgEvj"),emailjs.send("service_csl8frv","template_0v2mqw9",n).then((()=>console.log("[EmailJS] 邮件发送成功"))).catch((e=>{console.error("[EmailJS] 邮件失败",e),alert("⚠️ 邮件发送失败，请将导出的 PDF 手动发送到 RSEC 邮箱：rsec@armstrong.com"),showEmailResultPopup("❌ 邮件发送失败，是否重新发送？")}))},document.head.appendChild(e)}}catch(e){console.error("提交失败：",e),alert("提交失败，请稍后重试。\n错误信息："+e.message)}finally{e?.classList.add("hidden")}}function validateForm(){return console.warn("[调试模式] 表单验证已跳过"),!0}function promptPasswordAndSend(e){document.getElementById("passwordModal").classList.remove("hidden"),window.confirmPassword=async function(t){const n=document.getElementById("passwordInput").value.trim();showUniversalModal("动态验证码","请输入验证码以发送成绩",!0,(e=>{if("AFT2025"===e){const e=buildEmailTable();sendResultEmail(e)}else alert("验证码错误")}));const a="AFT2025"===n;await exportResultPDF(e),t&&a?await sendResultEmail(e):t&&!a?alert("❌ 动态口令错误，未发送邮件，仅导出 PDF。"):alert("✅ 已跳过邮件，仅保存本地 PDF。")}}async function exportResultPDF(e){const t=document.getElementById("completePage"),n=e.userInfo.name||"未命名";await html2pdf().from(t).set({margin:0,filename:`DE-PUMP评测结果_${n}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}}).save()}async function sendResultEmail(e){const t=generateEmailTableHTML(e),n={company:e.userInfo.company,user_name:e.userInfo.name,phone:e.userInfo.phone,user_email:e.userInfo.email,timestamp:(new Date).toLocaleString("zh-CN",{hour12:!1}),message:"DE-PUMP产品培训自动提交答卷",table_html:t};try{window.emailjs||await new Promise((e=>{const t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js",t.onload=e,document.head.appendChild(t)})),emailjs.init("LoQCI3C98dk3FgEvj"),await emailjs.send("service_csl8frv","template_0v2mqw9",n),alert("✅ 邮件已成功发送！")}catch(e){console.error("[EmailJS] 邮件发送失败：",e),showEmailResultPopup("❌ 邮件发送失败，是否重新发送？")}}function sendEmailWithTemplate(e,t=null,n=null){const a="service_csl8frv",o="template_0v2mqw9",l="LoQCI3C98dk3FgEvj";if("undefined"==typeof emailjs){const s=document.createElement("script");s.src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js",s.onload=()=>{emailjs.init(l),emailjs.send(a,o,e).then((()=>{console.log("[EmailJS] 邮件发送成功"),alert("✅ 评测结果已成功发送至 RSEC 邮箱！"),"function"==typeof t&&t()})).catch((e=>{console.error("[EmailJS] 邮件发送失败:",e),showEmailResultPopup("❌ 邮件发送失败，是否重新发送？"),"function"==typeof n&&n(e)}))},s.onerror=()=>{console.error("[EmailJS] 模块加载失败"),"function"==typeof n&&n(new Error("模块加载失败"))},document.head.appendChild(s)}else emailjs.init(l),emailjs.send(a,o,e).then((()=>{console.log("[EmailJS] 邮件发送成功"),alert("✅ 评测结果已成功发送至 RSEC 邮箱！"),"function"==typeof t&&t()})).catch((e=>{console.error("[EmailJS] 邮件发送失败:",e),showEmailResultPopup("❌ 邮件发送失败，是否重新发送？"),"function"==typeof n&&n(e)}))}function generateEmailTableHTML(){const e=document.getElementById("completePage");if(!e)return console.error("❌ 未找到完成页内容 completePage！"),"<p>⚠️ 未找到评测结果内容。</p>";const t=e.cloneNode(!0);return t.querySelectorAll("script").forEach((e=>e.remove())),`\n    <style>\n      table { border-collapse: collapse; width: 100%; margin-bottom: 20px; font-family: sans-serif; font-size: 14px; }\n      th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: center; }\n      thead { background-color: #f3f4f6; color: #111827; }\n      .title { background-color: #ef4444; color: white; font-weight: bold; }\n    </style>\n    ${t.innerHTML}\n  `}async function handleScreenshotAndEmail(){try{const e=collectAnswers(),t=e.userInfo.name||"匿名用户",n=document.getElementById("completePage");await html2pdf().from(n).set({margin:0,filename:`DE-PUMP评测结果_${t}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}}).save();const a=generateEmailTableHTML(e),o={company:e.userInfo.company,user_name:t,phone:e.userInfo.phone,user_email:e.userInfo.email,timestamp:(new Date).toLocaleString("zh-CN",{hour12:!1}),message:"系统自动提交：DE-PUMP产品培训答卷（手动触发）",table_html:a};emailjs.send("service_csl8frv","template_0v2mqw9",o).then((()=>alert("✅ 邮件已成功发送！"))).catch((e=>{console.error("[EmailJS] 邮件发送失败：",e),showEmailResultPopup("❌ 邮件发送失败，是否重新发送？")}))}catch(e){console.error("[发送错误]：",e),alert("❌ 出现错误，无法完成操作，请稍后重试！")}}function confirmStartEvaluation(){if(confirm("您确定开始进行评测吗？\n提交后将自动推送给 Armstrong RSEC 部门，并导出 PDF。")){const e=sessionStorage.getItem("userAnswers");if(!e)return void alert("⚠️ 无法获取答题数据，请重新提交！");const t=JSON.parse(e);sessionStorage.setItem("hasEvaluated","true"),promptPasswordAndSend(t)}else alert("已取消评测，您可继续检查答题内容。")}function returnToTestPage(){"true"!==sessionStorage.getItem("hasEvaluated")?(showPage("testPage"),document.querySelectorAll('input[type="radio"]:checked, input[type="checkbox"]:checked').forEach((e=>e.checked=!1)),document.getElementById("essay").value="",window.scrollTo(0,0)):alert("⚠️ 您已完成评测，带有完成时间的结果已经发送出去，无法返回修改答卷！")}function startEvaluationPrompt(){confirm("您确定要开始进行评测吗？\n评测后将自动导出 PDF，并发送结果至 Armstrong RSEC。")?promptPasswordAndSend():alert("已取消评测操作。您仍可检查答题内容。")}function exportPDF(e){const t=e?.userInfo||{},n=t.name||"匿名用户",a=(t.email,t.company,t.phone,document.getElementById("completePage"));html2pdf().from(a).set({margin:[10,10,10,10],filename:`DE-PUMP评测结果_${n}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,scrollX:0,scrollY:0,windowWidth:a.scrollWidth,windowHeight:a.scrollHeight},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}}).save()}function showRetryModal(){document.getElementById("emailRetryModal").classList.remove("hidden")}function closeRetryModal(){document.getElementById("emailRetryModal").classList.add("hidden")}console.log("绑定 retryEmailBtn...");const btn=document.getElementById("retryEmailBtn");function reinitializeEmailJS(){if(window.emailjs)try{emailjs.init("LoQCI3C98dk3FgEvj"),console.log("✅ EmailJS 已重新初始化")}catch(e){console.error("❌ EmailJS 初始化失败",e)}else console.error("⚠️ EmailJS 模块未加载")}function retryEmailSend(){hideEmailResultPopup(),reinitializeEmailJS(),setTimeout((()=>{handleExportWithPDFAndEmail()}),200)}function showEmailResultPopup(e){const t=`\n    <div id="emailResultPopup" class="fixed inset-0 bg-black bg-opacity-50 z-[9999] flex items-center justify-center">\n      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 w-[300px] text-center fade-in-bounce">\n        <p class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">${e}</p>\n        <div class="flex justify-center gap-4">\n          <button id="retrySendBtn" class="bg-blue-600 text-white px-4 py-1.5 rounded hover:bg-blue-700">是</button>\n          <button id="cancelSendBtn" class="bg-gray-300 text-gray-800 px-4 py-1.5 rounded hover:bg-gray-400">否</button>\n        </div>\n      </div>\n    </div>\n  `;document.body.insertAdjacentHTML("beforeend",t),document.getElementById("retrySendBtn").onclick=()=>{document.getElementById("emailResultPopup").remove(),emailjs.init("LoQCI3C98dk3FgEvj");try{handleExportWithPDFAndEmail(!0)}catch(e){alert("邮件再次发送失败，请稍后再试。")}},document.getElementById("cancelSendBtn").onclick=()=>{document.getElementById("emailResultPopup").remove()}}console.log("retryEmailBtn =",btn),btn?btn.addEventListener("click",(()=>{if(closeRetryModal(),window.emailjs)try{emailjs.init("LoQCI3C98dk3FgEvj")}catch(e){console.error("EmailJS 初始化失败",e)}handleEmailSendAgain()})):console.warn("⚠️ 没有找到 #retryEmailBtn，跳过绑定")</script><script>document.addEventListener("DOMContentLoaded",(()=>{for(let e=0;e<30;e++){const e=document.createElement("div");e.className="watermark-random",e.style.top=120*Math.random()-10+"vh",e.style.left=120*Math.random()-10+"vw",e.style.transform=`rotate(30deg) scale(${.7+.6*Math.random()})`,document.body.appendChild(e)}}))</script><div id=passwordModal class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center"><div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md w-full max-w-sm text-center"><h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">请输入动态口令以发送评测结果至邮箱</h3><input id=passwordInput type=password placeholder=请输入口令... class="w-full p-2 border rounded-md mb-4 focus:outline-none focus:ring focus:border-blue-300"><div class="flex justify-between space-x-4"><button onclick=confirmPassword(!0) class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded">确定</button> <button onclick=confirmPassword(!1) class="flex-1 bg-gray-400 hover:bg-gray-500 text-white py-2 rounded">跳过发送</button></div></div></div><div id=countdownCenterOverlay class="hidden fixed inset-0 flex"><div class=text-center><p>当前考试已暂停</p><p>点击下方按钮可恢复考试</p><button onclick=resumeFromCenterOverlay()>继续答题</button></div></div><script>document.addEventListener("DOMContentLoaded",(function(){startTimer()}))</script><div id=emailRetryModal class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center"><div class="bg-white dark:bg-gray-800 rounded-xl p-6 w-80 text-center shadow-lg"><p class="text-lg font-semibold text-gray-900 dark:text-white mb-4">邮件发送失败，是否重试？</p><div class="flex justify-center gap-4"><button id=retryEmailBtn onclick=retryEmailSend() class="bg-green-500 hover:bg-green-600 ...">是，重新发送</button> <button id=retryEmailBtn onclick=hideEmailResultPopup() class="bg-gray-400 hover:bg-gray-500 ...">否，暂不发送</button></div></div></div><script>function validateUserInfo(){const e=document.getElementById("company")?.value.trim(),t=document.getElementById("name")?.value.trim(),n=document.getElementById("phone")?.value.trim(),a=document.getElementById("email")?.value.trim();if(!(e&&t&&n&&a))return alert("请先完整填写学员信息（公司、姓名、手机号、邮箱）后再提交答卷！"),!1;return/^\d{11}$/.test(n)?!!/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(a)||(alert("邮箱格式不正确，请检查！"),!1):(alert("手机号格式不正确，应为 11 位数字"),!1)}window.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("submitBtn");e&&e.addEventListener("click",(()=>{validateUserInfo()&&confirmSubmitTest()}))}))</script><script src=https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js></script><script>if(void 0===currentLang)var currentLang="zh";function loadQuestionsFromCSV(t){Papa.parse(t,{download:!0,header:!0,complete:function(t){const n=t.data.filter((t=>"简答题"===t["题型"]));if(n.length>0){const t=n[0],e=document.querySelector("#short1");if(e){const n="en"===currentLang?t["English Question"]:t["中文题干"];e.querySelector("h3").textContent=n}}}})}function switchLanguage(t){currentLang=t,loadQuestionsFromCSV("/static/csv/DE-PUMP.csv")}window.addEventListener("DOMContentLoaded",(()=>{loadQuestionsFromCSV("/static/csv/DE-PUMP.csv")}))</script><script src=https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js></script><script>if(void 0===currentLang)var currentLang="zh";document.addEventListener("DOMContentLoaded",(function(){const e=`/static/csv/DE-PUMP.csv?t=${(new Date).toISOString().replace(/[-:TZ.]/g,"")+"_"+Date.now()}`;Papa.parse(e,{download:!0,header:!0,complete:function(e){const t=e.data;t.filter((e=>"单选题"===e["题型"])).forEach(((e,t)=>{const n=t+1,r=document.querySelector(`#q${n}`);if(!r)return;const o="en"===currentLang?e["English Question"]:e["中文题干"],c=r.querySelector("h3");c&&(c.textContent=`${n}. ${o}`),["A","B","C","D"].forEach((t=>{const o=r.querySelector(`label[for="q${n}-${t}"]`),c="en"===currentLang?e[t+"_EN"]:e[t];o&&c&&(o.innerHTML=`<input type="radio" id="q${n}-${t}" name="q${n}" value="${t}"> ${t}. ${c}`)}))})),t.filter((e=>"多选题"===e["题型"])).forEach(((e,t)=>{const n=t+1,r=document.querySelector(`#multi${n}`);if(!r)return;const o="en"===currentLang?e["English Question"]:e["中文题干"],c=r.querySelector("h3");c&&(c.textContent=`${n}. ${o}`),["A","B","C","D","E","F"].forEach((t=>{const o=r.querySelector(`label[for="m${n}-${t}"]`),c="en"===currentLang?e[t+"_EN"]:e[t];o&&c&&(o.innerHTML=`<input type="checkbox" id="m${n}-${t}" name="multi${n}" value="${t}"> ${t}. ${c}`)}))})),t.filter((e=>"判断题"===e["题型"])).forEach(((e,t)=>{const n=t+1,r=document.querySelector(`#jq${n}`);if(!r)return;const o="en"===currentLang?e["English Question"]:e["中文题干"],c=r.querySelector("h3");c&&(c.textContent=`${n}. ${o}`)}));const n=t.find((e=>"简答题"===e["题型"])),r=document.querySelector("#short1");if(n&&r){const e="en"===currentLang?n["English Question"]:n["中文题干"],t=r.querySelector("h3");t&&(t.textContent=e)}},error:function(e){console.error("❌ 题库加载失败：",e)}})}))</script><script>let lastActivityTime=Date.now();const recordActivity=()=>{lastActivityTime=Date.now()};["mousemove","mousedown","keydown","scroll","touchstart"].forEach((t=>{document.addEventListener(t,recordActivity)})),setInterval((()=>{Date.now()-lastActivityTime<6e4&&fetch("/heartbeat",{method:"POST"}).then((t=>{440===t.status&&(alert("登录已超时，请重新登录！"),window.location.href="/login")})).catch((()=>{}))}),6e4)</script><div id=loginOverlay class="hidden fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center"><div class="bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-xs shadow-xl"><h2 class="text-lg font-bold text-center mb-4">会话已过期，请重新登录</h2><input id=reLoginUser class="w-full mb-3 px-4 py-2 rounded-md bg-gray-100 dark:bg-gray-700" placeholder=用户名> <input id=reLoginPass type=password class="w-full mb-3 px-4 py-2 rounded-md bg-gray-100 dark:bg-gray-700" placeholder=密码> <button onclick=submitRelogin() class="w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">重新登录</button></div></div><script>function showLoginOverlay(){document.getElementById("loginOverlay").classList.remove("hidden")}async function submitRelogin(){const e=document.getElementById("reLoginUser").value.trim(),n=document.getElementById("reLoginPass").value.trim();(await fetch("/login",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({username:e,password:n})})).redirected?location.reload():alert("重新登录失败，请检查用户名或密码")}document.getElementById("reLoginPass").addEventListener("keyup",(function(e){"Enter"===e.key&&submitRelogin()}))</script><script>function closeLoginOverlay(){document.getElementById("loginOverlay").classList.add("hidden")}</script><script src=https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js></script><script>if(void 0===currentLang)var currentLang="zh";document.addEventListener("DOMContentLoaded",(function(){Papa.parse("/static/csv/DE-PUMP.csv",{download:!0,header:!0,complete:function(e){const n=e.data;n.filter((e=>"单选题"===e["题型"])).forEach(((e,n)=>{const t=n+1,r=document.querySelector(`#q${t}`);if(!r)return;const o="en"===currentLang?e["English Question"]:e["中文题干"],c=r.querySelector("h3");c&&(c.textContent=`${t}. ${o}`),["A","B","C","D"].forEach((n=>{const o=r.querySelector(`label[for="q${t}-${n}"]`),c="en"===currentLang?e[n+"_EN"]:e[n];o&&c&&(o.innerHTML=`<input type="radio" id="q${t}-${n}" name="q${t}" value="${n}"> ${n}. ${c}`)}))})),n.filter((e=>"多选题"===e["题型"])).forEach(((e,n)=>{const t=n+1,r=document.querySelector(`#multi${t}`);if(!r)return;const o="en"===currentLang?e["English Question"]:e["中文题干"],c=r.querySelector("h3");c&&(c.textContent=`${t}. ${o}`),["A","B","C","D","E","F"].forEach((n=>{const o=r.querySelector(`label[for="m${t}-${n}"]`),c="en"===currentLang?e[n+"_EN"]:e[n];o&&c&&(o.innerHTML=`<input type="checkbox" id="m${t}-${n}" name="multi${t}" value="${n}"> ${n}. ${c}`)}))})),n.filter((e=>"判断题"===e["题型"])).forEach(((e,n)=>{const t=n+1,r=document.querySelector(`#jq${t}`);if(!r)return;const o="en"===currentLang?e["English Question"]:e["中文题干"],c=r.querySelector("h3");c&&(c.textContent=`${t}. ${o}`)}));const t=n.find((e=>"简答题"===e["题型"])),r=document.querySelector("#short1");if(t&&r){const e="en"===currentLang?t["English Question"]:t["中文题干"],n=r.querySelector("h3");n&&(n.textContent=e)}},error:function(e){console.error("❌ 题库加载失败：",e)}})}))</script><script src=/static/common/render.js></script><script>document.addEventListener("DOMContentLoaded",(function(){const n=window.location.pathname.split("/").pop().replace(".html","");loadCSVAndInit(n)}))</script><div id=universalModal class="fixed z-50 inset-0 overflow-y-auto bg-gray-800 bg-opacity-50 flex items-center justify-center hidden"><div class="bg-white dark:bg-gray-900 p-6 rounded-lg shadow-lg w-full max-w-md text-center"><h2 id=modalTitle class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-100">提示标题</h2><p id=modalMessage class="text-gray-700 dark:text-gray-300 mb-6">提示内容文本，可根据实际内容动态设置</p><input id=modalInput class="bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600 rounded p-2 w-full mb-4 hidden" type=text placeholder=请输入内容><div class="flex justify-end gap-4"><button id=modalConfirmBtn class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">确定</button> <button onclick=closeUniversalModal() class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded">取消</button></div></div></div><script>function positionCountdownBar(){const n=document.getElementById("mainNavbar"),t=document.getElementById("examStatusBar");if(n&&t){const o=n.getBoundingClientRect(),e=window.scrollY||window.pageYOffset,d=o.bottom+e;t.style.top=`${d+0}px`}}window.addEventListener("DOMContentLoaded",positionCountdownBar),window.addEventListener("resize",positionCountdownBar)</script></div><script>const isLocalhost="localhost"===location.hostname||"127.0.0.1"===location.hostname;isLocalhost||(document.addEventListener("contextmenu",(e=>e.preventDefault())),document.addEventListener("keydown",(e=>{("F12"===e.key||e.ctrlKey&&e.shiftKey&&["I","J","C"].includes(e.key.toUpperCase())||e.ctrlKey&&"U"===e.key.toUpperCase())&&e.preventDefault()})))</script><div id=loadingMessageBar class="hidden fixed top-4 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white text-sm font-medium px-4 py-2 rounded shadow-md z-50">测试题加载中，请稍候...</div><script>window.addEventListener("DOMContentLoaded",(()=>{const e=document.documentElement,t=document.getElementById("themeToggle");e.classList.remove("dark"),localStorage.setItem("theme","light"),console.log("[Init] 强制设定为 Light 模式"),t&&t.addEventListener("click",(()=>{e.classList.toggle("dark");const t=e.classList.contains("dark")?"dark":"light";localStorage.setItem("theme",t),console.log(`[Click] 主题切换为 ${t}`)}))}))</script><script>window.addEventListener("DOMContentLoaded",(()=>{sessionStorage.getItem("entryFromCourse")?console.log("↩️ 从完成页返回，不清除答题记录"):(console.log("✅ 首次进入答题页，清除旧答题记录"),sessionStorage.removeItem("collectedAnswers"),sessionStorage.setItem("entryFromCourse","1"))}))</script><script>setInterval((()=>{Date.now()-lastActivityTime<6e4&&fetch("/heartbeat",{method:"POST"}).then((t=>{440===t.status&&(alert("登录已超时，请重新登录！"),window.location.href="/login")})).catch((()=>{}))}),6e4)</script><script>let inactivityTimer;function resetInactivityTimer(){clearTimeout(inactivityTimer),inactivityTimer=setTimeout((()=>{alert("由于您已长时间未操作，系统已自动退出。"),window.location.href="/logout"}),36e5)}["click","mousemove","keypress","scroll"].forEach((e=>document.addEventListener(e,resetInactivityTimer))),resetInactivityTimer()</script></body></html>